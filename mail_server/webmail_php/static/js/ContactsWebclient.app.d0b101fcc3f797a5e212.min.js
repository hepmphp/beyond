/*! For license information please see ContactsWebclient.app.d0b101fcc3f797a5e212.min.js.LICENSE.txt */
(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[335],{xGhG:(t,e,s)=>{"use strict";var i=s("EFhx"),o=s("Y40+");i.registerAbortRequestHandler(o.ServerModuleName,(function(t,e){switch(t.Method){case"GetContacts":return"GetContacts"===e.Method;case"GetContact":return"GetContact"===e.Method}return!1})),t.exports={send:function(t,e,s,r,n){i.send(o.ServerModuleName,t,e,s,r,n)}}},hW2p:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("xGhG"),r=s("3nom");function n(){this.oContacts={},this.oResponseHandlers={},this.aRequestedEmails=[],this.aVcardAttachments=[],this.oNewContactParams=null}n.prototype.clearInfoAboutEmail=function(t){this.oContacts[t]=void 0},n.prototype.getContactsByEmails=function(t,e){var s=[],r=[],n=Math.random().toString();i.each(t,i.bind((function(t){var e=this.oContacts[t];void 0!==e?s[t]=e:-1===i.indexOf(this.aRequestedEmails,t)&&r.push(t)}),this)),i.isFunction(e)&&e(s),r.length>0&&(this.oResponseHandlers[n]=e,this.aRequestedEmails=i.union(this.aRequestedEmails,r),o.send("GetContactsByEmails",{Storage:"all",Emails:r,HandlerId:n},this.onGetContactsByEmailsResponse,this))},n.prototype.onGetContactsByEmailsResponse=function(t,e){var s=e.Parameters,o=this.oResponseHandlers[s.HandlerId],n=t.Result,a=s.Emails,h={};n&&i.each(n,i.bind((function(t){var e=new r;e&&(e.parse(t),this.oContacts[e.email()]&&e.pgpSettingsEmpty()||(this.oContacts[e.email()]=e))}),this)),this.aRequestedEmails=i.difference(this.aRequestedEmails,a),i.each(a,i.bind((function(t){this.oContacts[t]||(this.oContacts[t]=null),h[t]=this.oContacts[t]}),this)),i.isFunction(o)&&o(h),delete this.oResponseHandlers[s.HandlerId]},n.prototype.addVcard=function(t){this.aVcardAttachments.push(t)},n.prototype.getVcard=function(t){return i.find(this.aVcardAttachments,(function(e){return e.file()===t}))},n.prototype.markVcardsExistentByFile=function(t){i.each(this.aVcardAttachments,(function(e){e.file()===t&&e.exists(!0)}))},n.prototype.updateVcardUid=function(t,e){var s=i.find(this.aVcardAttachments,(function(e){return e.file()===t}));s&&s.uid(e)},n.prototype.markVcardsNonexistentByUid=function(t){i.each(this.aVcardAttachments,(function(e){-1!==i.indexOf(t,e.uid())&&e.exists(!1)}))},n.prototype.saveNewContactParams=function(t){this.oNewContactParams=t},n.prototype.getNewContactParams=function(){var t=this.oNewContactParams;return this.oNewContactParams=null,t},t.exports=new n},Cjfl:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("M4cL"),r=s("p09A"),n=s("rhHV"),a=s("TdEd"),h=s("skxT"),l=a.run("MailWebclient","getComposeMessageToAddresses"),c=a.run("MailWebclient","getSearchMessagesInCurrentFolder"),u=s("oUN1"),p=s("muMM"),d=s("hW2p"),m={contacts:r.observableArray([]),ViewTemplate:"ContactsWebclient_ContactCardsView",bAllowComposeMessageToAddresses:i.isFunction(l),searchMessagesInCurrentFolder:c||function(){},bAllowSearchMessagesInCurrentFolder:i.isFunction(c),add:function(t){var e=i.filter(this.contacts(),(function(e){return-1===o.inArray(e.email(),i.keys(t))}));this.contacts(e.concat(i.compact(i.values(t))))}};function C(t,e){var s=o("div.item_viewer[data-email='"+e+"']"),i=!1,r=0,n=function(){s&&t&&(i=!0,clearTimeout(r),setTimeout((function(){var e,r,n,a=t.offset();i&&a.left+a.top!==0&&(e=a.left+10,r=a.top+t.height()+6,(n=o(window).width()-(e+396))>0&&(n=0),s.addClass("expand").offset({top:r,left:e+n}))}),180))},a=function(){i&&s&&t&&(i=!1,r=setTimeout((function(){i||s.removeClass("expand")}),200))};s.length>0?(t.off().on("mouseover",(function(){s.off().on("mouseenter",n).on("mouseleave",a).find(".link, .button").off(".links").on("click.links",(function(){i=!1,s.removeClass("expand")})),setTimeout(function(){s.find(".link, .button").off("click.links").on("click.links",(function(){i=!1,s.removeClass("expand")}))}.bind(this),100),n()})).on("mouseout",a),i=!1,s.removeClass("expand")):t.off()}function b(t){t.next().hasClass("add_contact")&&t.next().remove(),t.removeClass("found"),t.parent().removeClass("found_contact"),t.off()}function g(t,e){i.each(t,(function(s){var r=s.attr("data-email"),a=e[r];if(void 0!==a)if(b(s),null===a){var h=o('<span class="add_contact"></span>');s.after(h),n.init(h,"CONTACTSWEBCLIENT/ACTION_ADD_TO_CONTACTS"),h.on("click",(function(){u.showPopup(p,[s.attr("data-name"),r,function(e){i.each(t,(function(t){t.attr("data-email")===r&&(b(t),t.addClass("found"),t.parent().addClass("found_contact"),m.add(e),C(t,r))}))}])}))}else s.addClass("found"),s.parent().addClass("found_contact"),m.add(e),C(s,r)}))}h.showAnyView(m),t.exports={applyTo:function(t){var e=i.map(t,(function(t){return o(t)})),s=i.uniq(i.map(e,(function(t){return t&&t.attr("data-email")}))).slice(0,100);d.getContactsByEmails(s,i.bind(g,{},e))}}},lDT7:(t,e,s)=>{"use strict";var i=s("hW2p"),o={markVcardsExistentByFile:function(t){i.markVcardsExistentByFile(t)},updateVcardUid:function(t,e){i.updateVcardUid(t,e)}};window.MainTabContactsMethods=o,t.exports={}},"Y40+":(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("KC/L"),r=s("H20a");t.exports={ServerModuleName:"Contacts",HashModuleName:"contacts",ContactsPerPage:20,ImportContactsLink:"",AddressBooks:[],Storages:[],DefaultStorage:"personal",AllowAddressBooksManagement:!1,ContactsSortBy:{},ImportExportFormats:[],SaveVcfServerModuleName:"",init:function(t){var e=t[this.ServerModuleName];if(!i.isEmpty(e)){this.ContactsPerPage=o.pPositiveInt(e.ContactsPerPage,this.ContactsPerPage),this.ImportContactsLink=o.pString(e.ImportContactsLink,this.ImportContactsLink);var s=o.pArray(e.Storages,this.Storages);this.AddressBooks=i.filter(s,(function(t){return void 0!==t.CTag})),this.Storages=s,this.Storages.length>0&&(this.Storages.push({Id:"all",DisplayName:r.i18n("CONTACTSWEBCLIENT/LABEL_STORAGE_ALL")}),this.Storages.push({Id:"group"})),this.AllowAddressBooksManagement=o.pBool(e.AllowAddressBooksManagement,this.AllowAddressBooksManagement),this.ImportExportFormats=o.pArray(e.ImportExportFormats,this.ImportExportFormats),this.SaveVcfServerModuleName=o.pString(e.SaveVcfServerModuleName,this.SaveVcfServerModuleName),this.ContactsSortBy=this.getSortConfig(o.pObject(e.ContactsSortBy))}},update:function(t){this.ContactsPerPage=t},getSortConfig:function(t){return{Allow:o.pBool(t?.Allow),DisplayOptions:t?.DisplayOptions||[],DefaultSortBy:o.pEnum(Enums.ContactSortField[t?.DefaultSortBy],Enums.ContactSortField,Enums.ContactSortField.Name),DefaultSortOrder:o.pEnum(Enums.SortOrder[t?.DefaultSortOrder],Enums.SortOrder,Enums.SortOrder.Desc)}}}},Rq3T:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("M4cL"),r=(s("kG5I"),s("KC/L"),s("xGhG"));t.exports={callback:function(t,e,{storage:s="all",addContactGroups:n=!1,addUserGroups:a=!1,exceptEmail:h="",addEmailsToGroups:l=!1,useEmailAsValues:c=!1}){var u={Search:t.term,Storage:s,SortField:Enums.ContactSortField.Frequency,SortOrder:1,WithGroups:n,WithUserGroups:a,WithoutTeamContactsDuplicates:!0};r.send("GetContactSuggestions",u,(function(t){var s=[];t&&t.Result&&t.Result.List&&(s=(s=i.map(t.Result.List,(function(t){if(t.IsGroup&&t.Name)return t.Emails?{label:l?`${t.Name} (${t.Emails})`:t.Name,value:l?t.Emails:t.Name,name:t.Name,email:l?t.Emails:t.Name,groupId:t.Id,isUserGroup:!0,isAllUsersGroup:t.IsAll}:null;var e=t.ViewEmail,s="";return!c&&t.FullName&&0<o.trim(t.FullName).length&&(t.ForSharedToAll?e=t.FullName:t.IsGroup?(s=`${t.FullName} (${t.ViewEmail})`,e=t.ViewEmail):e='"'+t.FullName+'" <'+t.ViewEmail+">"),t&&t.ViewEmail&&t.ViewEmail!==h?{label:s||e,value:e,name:t.FullName,email:t.ViewEmail,frequency:t.Frequency,id:t.UUID,storage:t.Storage,uuid:t.UUID,team:"team"===t.Storage,sharedToAll:"shared"===t.Storage,hasKey:t.HasPgpPublicKey,encryptMessage:t.PgpEncryptMessages,signMessage:t.PgpSignMessages,isContactGroup:t.IsGroup}:null}))).filter((t=>t&&t.email)),s=i.sortBy(i.compact(s),(function(t){return-t.frequency}))),e(s)}))},deleteHandler:function(t){r.send("UpdateContact",{Contact:{UUID:t.id,Frequency:-1,Storage:t.storage}})}}},"8qea":(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("KC/L");void 0===window.Enums&&(window.Enums={}),i.extendOwn(window.Enums,{SharedAddressbookAccess:{NoAccess:0,Write:1,Read:2}}),t.exports={init(t,e){const s=t[e];window.Enums.ContactsPrimaryEmail=o.pObject(s&&s.PrimaryEmail),window.Enums.ContactsPrimaryPhone=o.pObject(s&&s.PrimaryPhone),window.Enums.ContactsPrimaryAddress=o.pObject(s&&s.PrimaryAddress),window.Enums.ContactSortField=o.pObject(s&&s.SortField)}}},xGtF:(t,e,s)=>{"use strict";t.exports=function(t){var e=s("a7T2"),i=s("H20a"),o=s("9kOp"),r=s("TdEd"),n=s("hW2p"),a=s("8qea"),h=s("Y40+"),l=s("rHGs"),c=s("Rq3T"),u={getSuggestionsAutocompleteCallback:function(t){var e=function(e,s){c.callback(e,s,t)};return r.run("OpenPgpWebclient","getSuggestionsAutocompleteFilteredCallback",[e])||e},getSuggestionsAutocompleteDeleteHandler:function(){return c.deleteHandler},getContactsByEmails:function(t,e){n.getContactsByEmails(t,e)}},p=function(){o.subscribeEvent("MailWebclient::RegisterMessagePaneController",(function(t){t(s("MYHY"),"BeforeMessageBody")}))},d={applyContactsCards:function(t){s("Cjfl").applyTo(t)}};return a.init(t,h.ServerModuleName),h.init(t),r.isModuleAvailable(h.ServerModuleName)&&o.isUserNormalOrTenant()?o.isMobile()?e.extend({start:p,getSettings:function(){return h},getHeaderItemView:function(){return s("zXiY")}},u):o.isNewTab()?e.extend({start:p},u,d):(s("lDT7"),e.extend({start:function(t){t.run("SettingsWebclient","registerSettingsTab",[function(){return s("Ub4N")},h.HashModuleName,i.i18n("CONTACTSWEBCLIENT/LABEL_SETTINGS_TAB")]),h.AllowAddressBooksManagement&&t.run("SettingsWebclient","registerSettingsTab",[function(){return s("h9EH")},"manage-addressbooks",i.i18n("CONTACTSWEBCLIENT/LABEL_MANAGE_ADDRESSBOOK_SETTINGS_TAB")]),p()},getScreens:function(){var t={};return t[h.HashModuleName]=function(){return new(s("iiou"))},t},getHeaderItem:function(){return{item:s("zXiY"),name:h.HashModuleName}},isTeamContactsAllowed:function(){return l.checkStorageExists("team")},getMobileSyncSettingsView:function(){return s("gBUy")}},u,d)):null}},Dj8t:(t,e,s)=>{"use strict";var i=s("p09A"),o=s("kG5I"),r=s("KC/L"),n=s("Y40+"),a=s("TdEd");function h(){this.bIsGroup=!1,this.bIsOrganization=!1,this.bReadOnly=!1,this.bItsMe=!1,this.bTeam=!1,this.sUUID="",this.sName="",this.sEmail="",this.bSharedToAll=!1,this.aEmails=[],this.deleted=i.observable(!1),this.checked=i.observable(!1),this.selected=i.observable(!1),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.sStorage=n.DefaultStorage,this.isOpenPgpEnabled=a.isModuleIncluded("OpenPgpWebclient"),this.HasPgpPublicKey=i.observable(!1)}h.prototype.parse=function(t){this.sUUID=r.pString(t.UUID),this.sName=r.pString(t.FullName||t.Name),this.sEmail=r.pString(t.ViewEmail),r.isNonEmptyArray(t.Emails)&&(this.aEmails=t.Emails),this.bIsGroup=!!t.IsGroup,this.bIsOrganization=!!t.IsOrganization,this.bReadOnly=!!t.ReadOnly,this.bItsMe=!!t.ItsMe,this.bTeam=!!t.IsTeam,this.bSharedToAll="shared"===t.Storage,this.sStorage=t.Storage,this.HasPgpPublicKey(!!t.HasPgpPublicKey)},h.prototype.IsGroup=function(){return this.bIsGroup},h.prototype.Team=function(){return this.bTeam},h.prototype.ReadOnly=function(){return this.bReadOnly},h.prototype.ItsMe=function(){return this.bItsMe},h.prototype.UUID=function(){return this.sUUID},h.prototype.Name=function(){return this.sName},h.prototype.Email=function(){return this.sEmail},h.prototype.getFullEmail=function(){return o.getFullEmail(this.sName,this.sEmail)},h.prototype.IsSharedToAll=function(){return this.bSharedToAll},h.prototype.IsOrganization=function(){return this.bIsOrganization},t.exports=h},"3nom":(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("M4cL"),r=s("p09A"),n=s("sdEb"),a=s("kG5I"),h=s("injE"),l=s("H20a"),c=s("KC/L"),u=s("xGhG"),p=s("/QeJ"),d=s("9kOp"),m=s("REt5"),C=s("jNBr"),b=s("Y40+"),g=s("TdEd");function S(){this.sEmailDefaultType=Enums.ContactsPrimaryEmail.Personal,this.sPhoneDefaultType=Enums.ContactsPrimaryPhone.Mobile,this.sAddressDefaultType=Enums.ContactsPrimaryAddress.Personal,this.uuid=r.observable(""),this.idUser=r.observable(0),this.team=r.observable(!1),this.itsMe=r.observable(!1),this.storage=r.observable("personal"),this.isNew=r.observable(!1),this.readOnly=r.observable(!1),this.edited=r.observable(!1),this.extented=r.observable(!1),this.personalCollapsed=r.observable(!1),this.businessCollapsed=r.observable(!1),this.otherCollapsed=r.observable(!1),this.pgpSettingsCollapsed=r.observable(!1),this.groupsCollapsed=r.observable(!1),this.displayName=r.observable(""),this.firstName=r.observable(""),this.lastName=r.observable(""),this.nickName=r.observable(""),this.skype=r.observable(""),this.facebook=r.observable(""),this.displayNameFocused=r.observable(!1),this.primaryEmail=r.observable(this.sEmailDefaultType),this.primaryPhone=r.observable(this.sPhoneDefaultType),this.primaryAddress=r.observable(this.sAddressDefaultType),this.mainPrimaryEmail=r.computed({read:this.primaryEmail,write:function(t){t&&0<=o.inArray(t,[Enums.ContactsPrimaryEmail.Personal,Enums.ContactsPrimaryEmail.Business,Enums.ContactsPrimaryEmail.Other])?this.primaryEmail(t):this.primaryEmail(Enums.ContactsPrimaryEmail.Personal)},owner:this}),this.mainPrimaryPhone=r.computed({read:this.primaryPhone,write:function(t){t&&0<=o.inArray(t,[Enums.ContactsPrimaryPhone.Mobile,Enums.ContactsPrimaryPhone.Personal,Enums.ContactsPrimaryPhone.Business])?this.primaryPhone(t):this.primaryPhone(Enums.ContactsPrimaryPhone.Mobile)},owner:this}),this.mainPrimaryAddress=r.computed({read:this.primaryAddress,write:function(t){t&&0<=o.inArray(t,[Enums.ContactsPrimaryAddress.Personal,Enums.ContactsPrimaryAddress.Business])?this.primaryAddress(t):this.primaryAddress(Enums.ContactsPrimaryAddress.Personal)},owner:this}),this.personalEmail=r.observable(""),this.personalStreetAddress=r.observable(""),this.personalCity=r.observable(""),this.personalState=r.observable(""),this.personalZipCode=r.observable(""),this.personalCountry=r.observable(""),this.personalWeb=r.observable(""),this.personalFax=r.observable(""),this.personalPhone=r.observable(""),this.personalMobile=r.observable(""),this.businessEmail=r.observable(""),this.businessCompany=r.observable(""),this.businessDepartment=r.observable(""),this.businessJob=r.observable(""),this.businessOffice=r.observable(""),this.businessStreetAddress=r.observable(""),this.businessCity=r.observable(""),this.businessState=r.observable(""),this.businessZipCode=r.observable(""),this.businessCountry=r.observable(""),this.businessWeb=r.observable(""),this.businessFax=r.observable(""),this.businessPhone=r.observable(""),this.otherEmail=r.observable(""),this.otherBirthMonth=r.observable(0),this.otherBirthDay=r.observable(0),this.otherBirthYear=r.observable(0),this.otherNotes=r.observable(""),this.etag=r.observable(""),this.isOpenPgpEnabled=g.isModuleIncluded("OpenPgpWebclient"),this.isOpenPgpInMailEnabled=g.run("OpenPgpWebclient","getOpenPgpInMailEnabledObservable")||r.observable(!1),this.publicPgpKeyView=r.observable(""),this.publicPgpKey=r.observable(""),this.pgpEncryptMessages=r.observable(!1),this.pgpSignMessages=r.observable(!1),this.publicPgpKey.subscribe((function(t){""!==t?g.run("OpenPgpWebclient","getKeyInfo",[t,function(t){t?this.publicPgpKeyView(t.getUser()+" ("+t.getBitSize()+"-bit)"):this.publicPgpKeyView("")}.bind(this)]):this.publicPgpKeyView("")}),this),this.sharedToAll=r.observable(!1),this.birthdayIsEmpty=r.computed((function(){var t=0===this.otherBirthMonth(),e=0===this.otherBirthDay(),s=0===this.otherBirthYear();return t||e||s}),this),this.otherBirthday=r.computed((function(){var t="",e=this.otherBirthYear(),s=this.otherBirthMonth(),i=this.otherBirthDay(),o=new C;if(!this.birthdayIsEmpty()){var r=n().diff(n(e+"/"+s+"/"+i,"YYYY/MM/DD"),"years"),a=l.i18n("CONTACTSWEBCLIENT/LABEL_YEARS_PLURAL",{COUNT:r},null,r);o.setDate(e,0<s?s-1:0,i),t=o.getShortDate()+" ("+a+")"}return t}),this),this.groups=r.observableArray([]),this.groupsIsEmpty=r.computed((function(){return 0===this.groups().length}),this),this.email=r.computed({read:function(){var t="";switch(this.primaryEmail()){case Enums.ContactsPrimaryEmail.Personal:t=this.personalEmail();break;case Enums.ContactsPrimaryEmail.Business:t=this.businessEmail();break;case Enums.ContactsPrimaryEmail.Other:t=this.otherEmail()}return t},write:function(t){switch(this.primaryEmail()){case Enums.ContactsPrimaryEmail.Personal:this.personalEmail(t);break;case Enums.ContactsPrimaryEmail.Business:this.businessEmail(t);break;case Enums.ContactsPrimaryEmail.Other:this.otherEmail(t);break;default:this.primaryEmail(this.sEmailDefaultType),this.email(t)}},owner:this}),this.showEncryptSignFlags=r.computed((function(){return this.isOpenPgpInMailEnabled()&&this.publicPgpKeyView()}),this),this.personalIsEmpty=r.computed((function(){return""==""+(this.personalEmail()!==this.email()?this.personalEmail():"")+this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()}),this),this.businessIsEmpty=r.computed((function(){return""==""+(this.businessEmail()!==this.email()?this.businessEmail():"")+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+this.businessPhone()}),this),this.otherIsEmpty=r.computed((function(){return""==""+(this.otherEmail()!==this.email()?this.otherEmail():"")+this.otherNotes()&&this.birthdayIsEmpty()}),this),this.pgpSettingsEmpty=r.computed((function(){return"string"!=typeof this.publicPgpKey()||""===this.publicPgpKey()}),this),this.phone=r.computed({read:function(){var t="";switch(this.primaryPhone()){case Enums.ContactsPrimaryPhone.Mobile:t=this.personalMobile();break;case Enums.ContactsPrimaryPhone.Personal:t=this.personalPhone();break;case Enums.ContactsPrimaryPhone.Business:t=this.businessPhone()}return t},write:function(t){switch(this.primaryPhone()){case Enums.ContactsPrimaryPhone.Mobile:this.personalMobile(t);break;case Enums.ContactsPrimaryPhone.Personal:this.personalPhone(t);break;case Enums.ContactsPrimaryPhone.Business:this.businessPhone(t);break;default:this.primaryPhone(this.sEmailDefaultType),this.phone(t)}},owner:this}),this.address=r.computed({read:function(){var t="";switch(this.primaryAddress()){case Enums.ContactsPrimaryAddress.Personal:t=this.personalStreetAddress();break;case Enums.ContactsPrimaryAddress.Business:t=this.businessStreetAddress()}return t},write:function(t){switch(this.primaryAddress()){case Enums.ContactsPrimaryAddress.Personal:this.personalStreetAddress(t);break;case Enums.ContactsPrimaryAddress.Business:this.businessStreetAddress(t);break;default:this.primaryAddress(this.sEmailDefaultType),this.address(t)}},owner:this}),this.emails=r.computed((function(){var t=[];return""!==this.personalEmail()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_PERSONAL")+": "+this.personalEmail(),value:Enums.ContactsPrimaryEmail.Personal}),""!==this.businessEmail()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_BUSINESS")+": "+this.businessEmail(),value:Enums.ContactsPrimaryEmail.Business}),""!==this.otherEmail()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_OTHER")+": "+this.otherEmail(),value:Enums.ContactsPrimaryEmail.Other}),t}),this),this.phones=r.computed((function(){var t=[];return""!==this.personalMobile()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_MOBILE")+": "+this.personalMobile(),value:Enums.ContactsPrimaryPhone.Mobile}),""!==this.personalPhone()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_PERSONAL")+": "+this.personalPhone(),value:Enums.ContactsPrimaryPhone.Personal}),""!==this.businessPhone()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_BUSINESS")+": "+this.businessPhone(),value:Enums.ContactsPrimaryPhone.Business}),t}),this),this.addresses=r.computed((function(){var t=[];return""!==this.personalStreetAddress()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_PERSONAL")+": "+this.personalStreetAddress(),value:Enums.ContactsPrimaryAddress.Personal}),""!==this.businessStreetAddress()&&t.push({text:l.i18n("CONTACTSWEBCLIENT/LABEL_BUSINESS")+": "+this.businessStreetAddress(),value:Enums.ContactsPrimaryAddress.Business}),t}),this),this.hasEmails=r.computed((function(){return 0<this.emails().length}),this),this.allowSendThisContact=r.computed((function(){return""!==b.SaveVcfServerModuleName}),this),this.extented.subscribe((function(t){t&&(this.personalCollapsed(!this.personalIsEmpty()),this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.pgpSettingsCollapsed(!this.pgpSettingsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))}),this),this.birthMonthSelect=S.birthMonthSelect,this.birthDaySelect=r.computed((function(){for(var t=1,e=h.daysInMonth(this.otherBirthMonth(),this.otherBirthYear()),s=[{text:l.i18n("COREWEBCLIENT/LABEL_DAY"),value:0}];t<=e;t++)s.push({text:t.toString(),value:t});return s}),this),this.birthYearSelect=[{text:l.i18n("CONTACTSWEBCLIENT/LABEL_YEAR"),value:0}];for(var t=(new Date).getFullYear(),e=t,s=t-100;e>=s;e--)this.birthYearSelect.push({text:e.toString(),value:e});this.canBeSave=r.computed((function(){return""!==this.displayName()||!!this.emails().length}),this),this.customCommands=r.observableArray([]),d.broadcastEvent("ContactsWebclient::AddCustomCommand",{Callback:i.bind((function(t){var e=i.extend({Text:"",CssClass:"",Handler:function(){},Visible:!0},t);e.Command=m.createCommand(this,e.Handler,!0),this.customCommands.push(e)}),this),Contact:this})}function E(t,e,s){const i=d.getUserId();return s?!!t[`${e}_${i}`]:!!t[e]}S.aBirthdayMonths=h.getMonthNamesArray(),S.birthMonthSelect=[{text:l.i18n("COREWEBCLIENT/LABEL_MONTH"),value:0},{text:S.aBirthdayMonths[0],value:1},{text:S.aBirthdayMonths[1],value:2},{text:S.aBirthdayMonths[2],value:3},{text:S.aBirthdayMonths[3],value:4},{text:S.aBirthdayMonths[4],value:5},{text:S.aBirthdayMonths[5],value:6},{text:S.aBirthdayMonths[6],value:7},{text:S.aBirthdayMonths[7],value:8},{text:S.aBirthdayMonths[8],value:9},{text:S.aBirthdayMonths[9],value:10},{text:S.aBirthdayMonths[10],value:11},{text:S.aBirthdayMonths[11],value:12}],S.prototype.clear=function(){this.uuid(""),this.idUser(0),this.team(!1),this.itsMe(!1),this.storage(""),this.isNew(!1),this.readOnly(!1),this.edited(!1),this.extented(!1),this.personalCollapsed(!1),this.businessCollapsed(!1),this.otherCollapsed(!1),this.pgpSettingsCollapsed(!1),this.groupsCollapsed(!1),this.displayName(""),this.firstName(""),this.lastName(""),this.nickName(""),this.skype(""),this.facebook(""),this.displayNameFocused(!1),this.primaryEmail(this.sEmailDefaultType),this.primaryPhone(this.sPhoneDefaultType),this.primaryAddress(this.sAddressDefaultType),this.personalEmail(""),this.personalStreetAddress(""),this.personalCity(""),this.personalState(""),this.personalZipCode(""),this.personalCountry(""),this.personalWeb(""),this.personalFax(""),this.personalPhone(""),this.personalMobile(""),this.businessEmail(""),this.businessCompany(""),this.businessDepartment(""),this.businessJob(""),this.businessOffice(""),this.businessStreetAddress(""),this.businessCity(""),this.businessState(""),this.businessZipCode(""),this.businessCountry(""),this.businessWeb(""),this.businessFax(""),this.businessPhone(""),this.otherEmail(""),this.otherBirthMonth(0),this.otherBirthDay(0),this.otherBirthYear(0),this.otherNotes(""),this.etag(""),this.publicPgpKeyView(""),this.publicPgpKey(""),this.pgpEncryptMessages(!1),this.pgpSignMessages(!1),this.sharedToAll(!1),this.groups([])},S.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.extented(!1),this.isNew(!0),d.isMobile()||this.displayNameFocused(!0)},S.prototype.switchToView=function(){this.edited(!1),this.extented(!1)},S.prototype.toObject=function(){return{UUID:this.uuid(),PrimaryEmail:this.primaryEmail(),PrimaryPhone:this.primaryPhone(),PrimaryAddress:this.primaryAddress(),FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),Storage:this.storage(),Skype:this.skype(),Facebook:this.facebook(),PersonalEmail:this.personalEmail(),PersonalAddress:this.personalStreetAddress(),PersonalCity:this.personalCity(),PersonalState:this.personalState(),PersonalZip:this.personalZipCode(),PersonalCountry:this.personalCountry(),PersonalWeb:this.personalWeb(),PersonalFax:this.personalFax(),PersonalPhone:this.personalPhone(),PersonalMobile:this.personalMobile(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),BusinessAddress:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthDay:this.otherBirthDay(),BirthMonth:this.otherBirthMonth(),BirthYear:this.otherBirthYear(),PublicPgpKey:this.publicPgpKey(),PgpEncryptMessages:this.pgpEncryptMessages(),PgpSignMessages:this.pgpSignMessages(),GroupUUIDs:this.groups()}},S.prototype.parse=function(t){this.uuid(c.pString(t.UUID)),this.idUser(c.pInt(t.IdUser)),this.team("team"===t.Storage),this.storage(c.pString(t.Storage)),this.itsMe(!!t.ItsMe),this.readOnly(!!t.ReadOnly),this.displayName(c.pString(t.FullName)),this.firstName(c.pString(t.FirstName)),this.lastName(c.pString(t.LastName)),this.nickName(c.pString(t.NickName)),this.skype(c.pString(t.Skype)),this.facebook(c.pString(t.Facebook)),this.primaryEmail(c.pInt(t.PrimaryEmail)),this.primaryPhone(c.pInt(t.PrimaryPhone)),this.primaryAddress(c.pInt(t.PrimaryAddress)),this.personalEmail(c.pString(t.PersonalEmail)),this.personalStreetAddress(c.pString(t.PersonalAddress)),this.personalCity(c.pString(t.PersonalCity)),this.personalState(c.pString(t.PersonalState)),this.personalZipCode(c.pString(t.PersonalZip)),this.personalCountry(c.pString(t.PersonalCountry)),this.personalWeb(c.pString(t.PersonalWeb)),this.personalFax(c.pString(t.PersonalFax)),this.personalPhone(c.pString(t.PersonalPhone)),this.personalMobile(c.pString(t.PersonalMobile)),this.businessEmail(c.pString(t.BusinessEmail)),this.businessCompany(c.pString(t.BusinessCompany)),this.businessDepartment(c.pString(t.BusinessDepartment)),this.businessJob(c.pString(t.BusinessJobTitle)),this.businessOffice(c.pString(t.BusinessOffice)),this.businessStreetAddress(c.pString(t.BusinessAddress)),this.businessCity(c.pString(t.BusinessCity)),this.businessState(c.pString(t.BusinessState)),this.businessZipCode(c.pString(t.BusinessZip)),this.businessCountry(c.pString(t.BusinessCountry)),this.businessWeb(c.pString(t.BusinessWeb)),this.businessFax(c.pString(t.BusinessFax)),this.businessPhone(c.pString(t.BusinessPhone)),this.otherEmail(c.pString(t.OtherEmail)),this.otherBirthMonth(c.pInt(t.BirthMonth)),this.otherBirthDay(c.pInt(t.BirthDay)),this.otherBirthYear(c.pInt(t.BirthYear)),this.otherNotes(c.pString(t.Notes)),this.etag(c.pString(t.ETag)),this.publicPgpKey(c.pString(t["OpenPgpWebclient::PgpKey"])),this.pgpEncryptMessages(E(t,"OpenPgpWebclient::PgpEncryptMessages",this.team())),this.pgpSignMessages(E(t,"OpenPgpWebclient::PgpSignMessages",this.team())),this.sharedToAll("shared"===t.Storage),i.isArray(t.GroupUUIDs)&&this.groups(t.GroupUUIDs)},S.prototype.getFullEmail=function(t){return c.isNonEmptyString(t)||(t=this.email()),a.getFullEmail(this.displayName(),t)},S.prototype.getEmailsString=function(){return i.uniq(i.without([this.email(),this.personalEmail(),this.businessEmail(),this.otherEmail()],"")).join(",")},S.prototype.sendThisContact=function(){var t=s("TdEd").run("MailWebclient","getComposeMessageWithAttachments"),e={UUID:this.uuid(),FileName:"contact-"+this.getFullEmail().replace('"',"").replace("<","").replace(">","")+".vcf"};u.send("SaveContactAsTempFile",e,(function(e){e.Result?i.isFunction(t)&&t([e.Result]):p.showErrorByCode(e,l.i18n("CONTACTSWEBCLIENT/ERROR_CONTACT_AS_TEMPFAILE"))}),this)},S.prototype.isStrLink=function(t){return/^http/.test(t)},t.exports=S},E3U2:(t,e,s)=>{"use strict";var i=s("p09A"),o=s("kG5I"),r=s("H20a"),n=s("9kOp");function a(){this.isNew=i.observable(!1),this.readOnly=i.observable(!1),this.uuid=i.observable(""),this.idUser=i.observable(0),this.name=i.observable(""),this.isOrganization=i.observable(!1),this.email=i.observable(""),this.country=i.observable(""),this.city=i.observable(""),this.company=i.observable(""),this.fax=i.observable(""),this.phone=i.observable(""),this.state=i.observable(""),this.street=i.observable(""),this.web=i.observable(""),this.zip=i.observable(""),this.edited=i.observable(!1),this.nameFocused=i.observable(!1),this.canBeSave=i.computed((function(){return""!==this.name()}),this),this.newContactsInGroupCount=i.observable(0),this.newContactsInGroupHint=i.computed((function(){var t=this.newContactsInGroupCount();return this.isNew()&&0<t?r.i18n("CONTACTSWEBCLIENT/INFO_NEW_GROUP_CONTACTS_PLURAL",{COUNT:t},null,t):""}),this)}a.prototype.getFullEmail=function(){return o.getFullEmail(this.name(),this.email())},a.prototype.clear=function(){this.isNew(!1),this.uuid(""),this.idUser(0),this.name(""),this.nameFocused(!1),this.edited(!1),this.isOrganization(!1),this.email(""),this.country(""),this.city(""),this.company(""),this.fax(""),this.phone(""),this.state(""),this.street(""),this.web(""),this.zip("")},a.prototype.populate=function(t){this.isNew(t.isNew()),this.uuid(t.uuid()),this.idUser(t.idUser()),this.name(t.name()),this.nameFocused(t.nameFocused()),this.edited(t.edited()),this.isOrganization(t.isOrganization()),this.email(t.email()),this.country(t.country()),this.city(t.city()),this.company(t.company()),this.fax(t.fax()),this.phone(t.phone()),this.state(t.state()),this.street(t.street()),this.web(t.web()),this.zip(t.zip())},a.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.isNew(!0),n.isMobile()||this.nameFocused(!0)},a.prototype.switchToView=function(){this.edited(!1)},a.prototype.toObject=function(t){return{UUID:this.uuid(),Name:this.name(),IsOrganization:this.isOrganization()?"1":"0",Email:this.email(),Country:this.country(),City:this.city(),Company:this.company(),Fax:this.fax(),Phone:this.phone(),State:this.state(),Street:this.street(),Web:this.web(),Zip:this.zip(),Contacts:t}},t.exports=a},CUTT:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("H20a"),n=s("KC/L"),a=s("/QeJ"),h=s("9kOp"),l=s("xGhG"),c=s("hW2p"),u=h.isNewTab()?null:s("zXiY"),p=h.isNewTab()&&window.opener?window.opener.MainTabContactsMethods:null;function d(){this.uid=o.observable(""),this.file=o.observable(""),this.name=o.observable(""),this.email=o.observable(""),this.exists=o.observable(!1),this.isJustSaved=o.observable(!1)}d.prototype.parse=function(t){t&&"Object/Aurora\\Modules\\Mail\\Classes\\Vcard"===t["@Object"]&&(this.uid(n.pString(t.Uid)),this.file(n.pString(t.File)),this.name(n.pString(t.Name)),this.email(n.pString(t.Email)),this.exists(!!t.Exists),c.addVcard(this))},d.prototype.onContactsSaveVcfResponse=function(t,e){t.Result?i.isArray(t.Result.ImportedUids)&&1===t.Result.ImportedUids.length&&(this.uid(t.Result.ImportedUids[0]),p&&p.updateVcardUid(this.file(),this.uid())):(a.showErrorByCode(t,r.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_CONTACT")),this.exists(!1))},d.prototype.addContact=function(){l.send("AddContactsFromFile",{File:this.file()},this.onContactsSaveVcfResponse,this),this.isJustSaved(!0),this.exists(!0),setTimeout(i.bind((function(){this.isJustSaved(!1)}),this),2e4),u?u.recivedAnim(!0):p&&p.markVcardsExistentByFile(this.file())},t.exports=d},muMM:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("H20a"),n=s("/QeJ"),a=s("W66n"),h=s("skxT"),l=s("o1lX"),c=s("rHGs"),u=s("xGhG"),p=s("hW2p"),d=s("zXiY");function m(){l.call(this),this.displayName=o.observable(""),this.email=o.observable(""),this.phone=o.observable(""),this.address=o.observable(""),this.skype=o.observable(""),this.facebook=o.observable(""),this.focusDisplayName=o.observable(!1),this.loading=o.observable(!1),this.fCallback=function(){}}i.extendOwn(m.prototype,l.prototype),m.prototype.PopupTemplate="ContactsWebclient_CreateContactPopup",m.prototype.onOpen=function(t,e,s){this.displayName()===t&&this.email()===e||(this.displayName(t),this.email(e),this.phone(""),this.address(""),this.skype(""),this.facebook("")),this.fCallback=i.isFunction(s)?s:function(){}},m.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var t={PrimaryEmail:Enums.ContactsPrimaryEmail.Personal,FullName:this.displayName(),PersonalEmail:this.email(),PersonalPhone:this.phone(),PersonalAddress:this.address(),Skype:this.skype(),Facebook:this.facebook(),Storage:"personal"};this.loading(!0),u.send("CreateContact",{Contact:t},this.onCreateContactResponse,this)}}else h.showError(r.i18n("CONTACTSWEBCLIENT/ERROR_EMAIL_OR_NAME_BLANK"))},m.prototype.cancelPopup=function(){this.loading(!1),this.closePopup()},m.prototype.onCreateContactResponse=function(t,e){var s=e.Parameters;this.loading(!1),t.Result?(h.showReport(r.i18n("CONTACTSWEBCLIENT/REPORT_CONTACT_SUCCESSFULLY_ADDED")),p.clearInfoAboutEmail(s.Contact.PersonalEmail),p.getContactsByEmails([s.Contact.PersonalEmail],this.fCallback),this.closePopup(),d.isCurrent()||d.recivedAnim(!0)):n.showErrorByCode(t,r.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_CONTACT"))},m.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},m.prototype.goToContacts=function(){p.saveNewContactParams({displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()}),this.closePopup(),a.replaceHash(c.getContacts("personal","","",1,"","create-contact"))},t.exports=new m},QgF7:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("H20a"),n=s("EFhx"),a=s("/QeJ"),h=s("o1lX"),l=s("skxT");function c(){h.call(this),this.createMode=o.observable(!1),this.saving=o.observable(!1),this.addressBookName=o.observable(""),this.addressBookNameFocus=o.observable(!1),this.fCallback=null}i.extendOwn(c.prototype,h.prototype),c.prototype.PopupTemplate="ContactsWebclient_EditAddressBookPopup",c.prototype.onOpen=function(t,e,s){this.fCallback=t,this.iEntityId=e,this.createMode(!this.iEntityId),this.addressBookName(s||""),this.addressBookNameFocus(!0)},c.prototype.save=function(){if(i.isEmpty(this.addressBookName()))return l.showError(r.i18n("CONTACTSWEBCLIENT/ERROR_ADDRESSBOOK_NAME_EMPTY")),void this.addressBookNameFocus(!0);var t=this.createMode()?"CreateAddressBook":"UpdateAddressBook",e={AddressBookName:this.addressBookName()};this.createMode()||(e.EntityId=this.iEntityId),this.addressBookNameFocus(!1),this.saving(!0),n.send("Contacts",t,e,this.onSaveAddressBookResponse,this)},c.prototype.onSaveAddressBookResponse=function(t,e){if(this.saving(!1),t&&t.Result){var s=this.createMode()?r.i18n("CONTACTSWEBCLIENT/REPORT_CREATE_ADDRESSBOOK"):r.i18n("CONTACTSWEBCLIENT/REPORT_UPDATE_ADDRESSBOOK");l.showReport(s),i.isFunction(this.fCallback)&&this.fCallback(),this.closePopup()}else{var o=this.createMode()?r.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_ADDRESSBOOK"):r.i18n("CONTACTSWEBCLIENT/ERROR_UPDATE_ADDRESSBOOK");a.showErrorByCode(t,o)}},c.prototype.cancelPopup=function(){this.saving()||this.closePopup()},t.exports=new c},rHGs:(t,e,s)=>{"use strict";var i=s("KC/L"),o=s("Y40+"),r={};function n(t){return"p"===t.substr(0,1)&&/^[1-9][\d]*$/.test(t.substr(1))}function a(t){return"cnt"===t.substr(0,3)}r.checkStorageExists=function(t){return!!o.Storages.find((e=>e.Id===t))},r.getContacts=function(t,e,s,r,n,a){var h=[o.HashModuleName];return t&&""!==t&&h.push(t),e&&""!==e&&h.push(e),s&&""!==s&&h.push(s),i.isNumber(r)&&h.push("p"+r),n&&""!==n&&h.push("cnt"+n),a&&""!==a&&h.push(a),h},r.parseContacts=function(t){var e=0,s=o.DefaultStorage,r="",h="",l=1,c="",u="";return i.isNonEmptyArray(t)&&(s=i.pString(t[e]),e++,o.Storages.find((t=>t.Id===s))||(s=o.DefaultStorage),"group"===s&&(t.length>e?(r=i.pString(t[e]),e++):s=o.DefaultStorage),t.length>e&&!n(t[e])&&!a(t[e])&&(h=i.pString(t[e]),e++),t.length>e&&n(t[e])&&(l=i.pInt(t[e].substr(1)),e++,l<=0&&(l=1)),t.length>e&&(a(t[e])?c=i.pString(t[e].substr(3)):u=i.pString(t[e]),e++)),{Storage:s,GroupUUID:r,Search:h,Page:l,ContactUUID:c,Action:u}},t.exports=r},h9EH:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("H20a"),n=s("EFhx"),a=s("/QeJ"),h=s("9kOp"),l=s("XeMN"),c=s("oUN1"),u=s("TdEd").run("SettingsWebclient","getAbstractSettingsFormViewClass"),p=s("QgF7");function d(){u.call(this),this.addressBooks=o.observableArray([]),this.loading=o.observable(!1)}i.extendOwn(d.prototype,u.prototype),d.prototype.ViewTemplate="ContactsWebclient_AddressBooksSettingsFormView",d.prototype.onShow=function(){this.populate()},d.prototype.populate=function(){this.loading(!0),n.send("Contacts","GetStorages",{},(function(t){if(this.loading(!1),i.isArray(t&&t.Result)){const e=h.getUserPublicId();this.addressBooks(t.Result.filter((t=>t?.Display&&t?.Owner===e&&"personal"!==t.Id)))}else a.showErrorByCode(t)}),this)},d.prototype.addAddressBook=function(){c.showPopup(p,[this.populate.bind(this)])},d.prototype.editAddressBook=function(t,e){c.showPopup(p,[this.populate.bind(this),t,e])},d.prototype.deleteAddressBook=function(t,e){var s=r.i18n("CONTACTSWEBCLIENT/CONFIRM_DELETE_ADDRESSBOOK",{NAME:e}),o=i.bind((function(e){e&&n.send("Contacts","DeleteAddressBook",{EntityId:t},(function(t){t&&t.Result||a.showErrorByCode(t),this.populate()}),this)}),this);c.showPopup(l,[s,o])},t.exports=new d},iiou:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("M4cL"),r=s("p09A"),n=s("Cox/"),a=s("H20a"),h=s("KC/L"),l=s("REt5"),c=s("/QeJ"),u=s("9kOp"),p=s("EFhx"),d=s("qBBW"),m=s("vdUg"),C=s("TdEd"),b=s("W66n"),g=s("skxT"),S=s("doeu"),E=s("yKBN"),y=s("oUN1"),f=s("XeMN"),v=s("rHGs"),A=s("xGhG"),T=s("hW2p"),I=s("Y40+"),P=s("Dj8t"),N=s("3nom"),w=s("E3U2"),U=s("7NIm"),O=window.Enums;function B(){S.call(this,"ContactsWebclient"),this.shareAddressbookControlView=C.run("SharedContacts","getShareAddressbookControlView"),this.browserTitle=r.observable(a.i18n("CONTACTSWEBCLIENT/HEADING_BROWSER_TAB")),this.contactCount=r.observable(0),this.uploaderArea=r.observable(null),this.dragActive=r.observable(!1),this.bDragActiveComp=r.computed((function(){return this.dragActive()}),this),this.sImportContactsLink=I.ImportContactsLink,this.loadingList=r.observable(!1),this.preLoadingList=r.observable(!1),this.loadingList.subscribe((function(t){this.preLoadingList(t)}),this),this.loadingViewPane=r.observable(!1),this.showPersonalContacts=r.observable(!1),this.showTeamContacts=r.observable(!1),this.showSharedToAllContacts=r.observable(!1),this.showAllContacts=r.computed((function(){return 1<[this.showPersonalContacts()?"1":"",this.showTeamContacts()?"1":"",this.showSharedToAllContacts()?"1":""].join("").length}),this),this.recivedAnimPersonal=r.observable(!1).extend({autoResetToFalse:500}),this.recivedAnimShared=r.observable(!1).extend({autoResetToFalse:500}),this.recivedAnimTeam=r.observable(!1).extend({autoResetToFalse:500}),this.isAddressBookSelected=r.observable(!1),this.isSelectedAddressbookSharedForReading=r.observable(!1),this.isTeamStorageSelected=r.observable(!1),this.isCustomAddressBookSelected=r.observable(!1),this.disableDropToPersonal=r.observable(!1),this.disableDropToSharedWithAll=r.observable(!1),this.disableDropToCustomAddressBook=r.observable(!1),this.selectedStorageValue=r.observable(""),this.selectedStorage=r.computed({read:function(){return this.selectedStorageValue()},write:function(t){if(""!==t){this.selectedStorageValue(v.checkStorageExists(t)?t:I.DefaultStorage),"group"!==this.selectedStorageValue()&&(this.selectedGroupInList(null),this.selectedItem(null),this.selector.listCheckedOrSelected(!1),this.currentGroupUUID(""));const e=this.addressBooks().find((t=>t.Id===this.selectedStorageValue()));this.isAddressBookSelected(!!e),this.isSelectedAddressbookSharedForReading(e&&e.Shared&&e.Access===O.SharedAddressbookAccess.Read);const s=this.selectedStorageValue().split("-");this.isCustomAddressBookSelected(s.length>0&&"addressbook"===s[0]),this.isTeamStorageSelected("team"===this.selectedStorageValue()),this.disableDropToPersonal("team"===this.selectedStorageValue()),this.disableDropToSharedWithAll("team"===this.selectedStorageValue()),this.disableDropToCustomAddressBook("team"===this.selectedStorageValue())}},owner:this}),this.addressBooks=r.observable(I.AddressBooks),u.subscribeEvent("ReceiveAjaxResponse::after",function(t){if("Contacts"===t.Request.Module&&"GetStorages"===t.Request.Method&&i.isArray(t.Response&&t.Response.Result)){this.addressBooks(t.Response.Result);var e=i.filter(I.Storages,(t=>void 0===t.Display));I.Storages=e.concat(this.addressBooks())}}.bind(this)),this.manageAddressBooksHash=r.computed((function(){return C.isModuleEnabled("SettingsWebclient")&&I.AllowAddressBooksManagement?b.buildHashFromArray(["settings","manage-addressbooks"]):"#"}),this),this.selectedGroupInList=r.observable(null),this.selectedGroupInList.subscribe((function(){var t=this.selectedGroupInList();t&&t.selected(!1)}),this,"beforeChange"),this.selectedGroupInList.subscribe((function(t){t&&this.showPersonalContacts()&&(t.selected(!0),this.selectedStorage("group"),this.requestContactList())}),this),this.selectedGroup=r.observable(null),this.selectedContact=r.observable(null),this.selectedGroupEmails=r.observableArray([]),this.currentGroupUUID=r.observable(""),this.oContactModel=new N,this.oGroupModel=new w,this.oImportView=new U(this),this.selectedOldItem=r.observable(null),this.selectedItem=r.computed({read:function(){return this.selectedContact()||this.selectedGroup()||null},write:function(t){t instanceof N?(this.selectedGroup(null),this.selectedContact(t)):t instanceof w?(this.selectedContact(null),this.selectedGroup(t),this.currentGroupUUID(t.uuid())):(this.selectedGroup(null),this.selectedContact(null)),this.loadingViewPane(!1)},owner:this}),this.collection=r.observableArray([]),this.contactUidForRequest=r.observable(""),this.collection.subscribe((function(){this.collection().length>0&&""!==this.contactUidForRequest()&&(this.requestContact(this.contactUidForRequest()),this.contactUidForRequest(""))}),this),this.bSortEnabled=I.ContactsSortBy&&I.ContactsSortBy.Allow&&I.ContactsSortBy.DisplayOptions&&I.ContactsSortBy.DisplayOptions.length>0,this.sortBy=r.observable(I.ContactsSortBy.DefaultSortBy),this.sortOrder=r.observable(I.ContactsSortBy.DefaultSortOrder),this.aSortList=[],this.bSortEnabled&&i.each(O.ContactSortField,function(t,e){I.ContactsSortBy.DisplayOptions.indexOf(e)>=0&&this.aSortList.push({sText:a.i18n("CONTACTSWEBCLIENT/SORT_OPTION_"+e.toUpperCase()),sSortBy:t})}.bind(this)),this.isSearchFocused=r.observable(!1),this.searchInput=r.observable(""),this.search=r.observable(""),this.groupUidForRequest=r.observable(""),this.groupFullCollection=r.observableArray([]),this.groupFullCollection.subscribe((function(){this.groupUidForRequest()&&this.onViewGroupClick(this.groupUidForRequest())}),this),this.selectedContact.subscribe((function(t){if(t){var e=t.groups();i.each(this.groupFullCollection(),(function(t){t.checked(t&&0<=o.inArray(t.UUID(),e))}))}}),this),this.pageSwitcherLocked=r.observable(!1),this.oPageSwitcher=new E(0,I.ContactsPerPage),this.oPageSwitcher.currentPage.subscribe((function(){this.pageSwitcherLocked()||this.changeRouting()}),this),this.currentPage=r.observable(1),this.search.subscribe((function(t){this.searchInput(t)}),this),this.searchSubmitCommand=l.createCommand(this,(function(){this.changeRouting({Search:this.searchInput()})})),this.searchMessagesInInbox=C.run("MailWebclient","getSearchMessagesInInbox"),this.bAllowSearchMessagesInInbox=i.isFunction(this.searchMessagesInInbox),this.composeMessageToAddresses=C.run("MailWebclient","getComposeMessageToAddresses"),this.bAllowComposeMessageToAddresses=i.isFunction(this.composeMessageToAddresses),this.selector=new m(this.collection,i.bind(this.viewContact,this),i.bind(this.deleteContact,this),this.bAllowComposeMessageToAddresses?i.bind(this.composeMessageToContact,this):null),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.isCheckedOrSelected=r.computed((function(){return 0<this.selector.listCheckedOrSelected().length}),this),this.isEnableAddContacts=this.isCheckedOrSelected,this.isEnableRemoveContactsFromGroup=this.isCheckedOrSelected,this.isEnableDeleting=this.isCheckedOrSelected,this.isDeleteVisible=r.computed((function(){return!this.isTeamStorageSelected()&&(this.showPersonalContacts()&&"personal"===this.selectedStorage()||this.showSharedToAllContacts()&&"shared"===this.selectedStorage()||this.isAddressBookSelected()&&!this.isSelectedAddressbookSharedForReading())}),this),this.isEnableSharing=this.isCheckedOrSelected,this.visibleShareCommand=r.computed((function(){return this.showPersonalContacts()&&this.showSharedToAllContacts()&&"personal"===this.selectedStorage()}),this),this.visibleUnshareCommand=r.computed((function(){return this.showPersonalContacts()&&this.showSharedToAllContacts()&&"shared"===this.selectedStorage()}),this),this.isExactlyOneContactSelected=r.computed((function(){return 1===this.selector.listCheckedOrSelected().length}),this),this.isSaving=r.observable(!1),this.isEnableCreateContact=r.computed((function(){return!this.isTeamStorageSelected()&&!this.isSelectedAddressbookSharedForReading()}),this),this.newContactCommand=l.createCommand(this,this.executeNewContact,this.isEnableCreateContact),this.newGroupCommand=l.createCommand(this,this.executeNewGroup),this.addContactsCommand=l.createCommand(this,(function(){}),this.isEnableAddContacts),this.deleteCommand=l.createCommand(this,this.deleteContact,this.isEnableDeleting),this.selectedCount=r.computed((function(){return i.filter(this.selector.listCheckedOrSelected(),(function(t){return!t.ReadOnly()})).length}),this),this.shareCommand=l.createCommand(this,this.executeShare,this.isEnableSharing),this.removeFromGroupCommand=l.createCommand(this,this.executeRemoveFromGroup,this.isEnableRemoveContactsFromGroup),this.isImportAllowed=r.computed((function(){return!this.isTeamStorageSelected()&&!this.isSelectedAddressbookSharedForReading()}),this),this.importCommand=l.createCommand(this,this.executeImport),this.saveCommand=l.createCommand(this,this.executeSave),this.saveEncryptSignFlagsCommand=l.createCommand(this,this.executeSaveEncryptSignFlags,(()=>!this.isSaving())),this.updateSharedToAllCommand=l.createCommand(this,this.executeUpdateSharedToAll,this.isExactlyOneContactSelected),this.composeMessageCommand=l.createCommand(this,this.composeMessage,this.isCheckedOrSelected),this.selector.listCheckedOrSelected.subscribe((function(t){this.oGroupModel.newContactsInGroupCount(t.length)}),this),this.isSearch=r.computed((function(){return""!==this.search()}),this),this.isEmptyList=r.computed((function(){return 0===this.collection().length}),this),this.searchText=r.computed((function(){return a.i18n("CONTACTSWEBCLIENT/INFO_SEARCH_RESULT",{SEARCH:this.search()})}),this),this.visibleDragNDropToGroupText=r.computed((function(){return!u.isMobile()&&"group"===this.selectedStorage()}),this),this.selectedPanel=r.observable(O.MobilePanel.Items),this.enableExport=r.computed((function(){return this.contactCount()>0}),this),this.aExportData=[],i.each(I.ImportExportFormats,(function(t){h.isNonEmptyString(t)&&this.aExportData.push({css:t.toLowerCase(),text:a.i18n("CONTACTSWEBCLIENT/ACTION_EXPORT_AS",{FORMAT:t.toUpperCase()}),command:l.createCommand(this,(function(){this.executeExport(t)}),this.enableExport)})}),this),this.visibleCreateOrImportText=r.computed((function(){return"all"!==this.selectedStorage()&&"shared"!==this.selectedStorage()&&"team"!==this.selectedStorage()&&"group"!==this.selectedStorage()}),this),this.visibleImportExport=r.computed((function(){return this.aExportData.length>0}),this),this.infoCreateOrImport=this.getCreateOrImportInfo(),this.listChanged=r.computed((function(){return[this.selectedStorage(),this.currentGroupUUID(),this.search(),this.oPageSwitcher.currentPage(),this.oPageSwitcher.perPage()]}),this),this.bRefreshContactList=!1,this.oPgpKeyControlsView=C.run("OpenPgpWebclient","getPgpKeyControlsView",[()=>{if(this.selectedContact()&&this.selectedContact().edited()){this.selectedContact().publicPgpKey("");const t=this.collection().find((t=>t.UUID()===this.selectedContact().uuid()));t&&t.HasPgpPublicKey(!1)}else this.onUpdateContactResponse({Result:!0})}]),u.broadcastEvent("ContactsWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}i.extendOwn(B.prototype,S.prototype),B.prototype.ViewTemplate="ContactsWebclient_ContactsScreenView",B.prototype.ViewConstructorName="CContactsView",B.prototype.executeSort=function(t){const e=this.sortBy();this.sortBy(t),e===t?this.sortOrder(this.sortOrder()===O.SortOrder.Asc?O.SortOrder.Desc:O.SortOrder.Asc):this.sortOrder(I.ContactsSortBy.DefaultSortOrder),this.requestContactList()},B.prototype.getFormatDependentText=function(t){switch(I.ImportExportFormats.length){case 0:return"";case 1:return a.i18n("CONTACTSWEBCLIENT/"+t+"_SINGLE_EXT",{EXTENSION:I.ImportExportFormats[0].toUpperCase()});default:return a.i18n("CONTACTSWEBCLIENT/"+t+"_PLURAL_EXT",{EXTENSIONS:i.initial(I.ImportExportFormats).join(", ").toUpperCase(),LASTEXTENSION:i.last(I.ImportExportFormats).toUpperCase()})}},B.prototype.getCreateOrImportInfo=function(){var t=this.getFormatDependentText("INFO_OR_IMPORT");return a.i18n("CONTACTSWEBCLIENT/INFO_CREATE")+(""===t?"":" "+t)+"."},B.prototype.executeSaveEncryptSignFlags=function(t){if(t instanceof N){const e={UUID:t.uuid(),PgpEncryptMessages:t.pgpEncryptMessages(),PgpSignMessages:t.pgpSignMessages()};this.isSaving(!0),p.send("OpenPgpWebclient","UpdateContactPublicKeyFlags",e,((t,e)=>{this.isSaving(!1),t&&t.Result?g.showReport(a.i18n("CONTACTSWEBCLIENT/REPORT_PGP_SETTINGS_SAVED")):c.showErrorByCode(t,a.i18n("CONTACTSWEBCLIENT/ERROR_SAVE_PGP_SETTINGS"))}))}},B.prototype.executeSave=function(t){var e,s={},o=[];if(t===this.selectedItem()&&this.selectedItem().canBeSave()){if(t instanceof N&&!t.readOnly())if(i.each(this.groupFullCollection(),(function(t){t&&t.checked()&&o.push(t.UUID())})),t.groups(o),this.selectedItem()&&T.clearInfoAboutEmail(this.selectedItem().email()),s=t.toObject(),"personal"!==this.selectedStorage()&&"personal"===s.Storage&&this.recivedAnimPersonal(!0),"team"!==this.selectedStorage()&&"team"===s.Storage&&this.recivedAnimTeam(!0),t.isNew()){"all"===this.selectedStorage()||"group"===this.selectedStorage()?s.Storage="personal":s.Storage=this.selectedStorage(),this.isSaving(!0),s.ViewEmail=t.email();var r={Contact:s,Callback:function(t){t.Error?(g.showError(t.ErrorMessage),this.isSaving(!1)):A.send("CreateContact",{Contact:s},this.onCreateContactResponse,this)}.bind(this)};u.broadcastEvent("ContactsWebclient::beforeCreateContactRequest",r)||A.send("CreateContact",{Contact:s},this.onCreateContactResponse,this)}else this.isSaving(!0),s.ViewEmail=t.email(),r={Contact:s,Callback:function(t){t.Error?(g.showError(t.ErrorMessage),this.isSaving(!1)):A.send("UpdateContact",{Contact:s},this.onUpdateContactResponse,this)}.bind(this)},u.broadcastEvent("ContactsWebclient::beforeUpdateContactRequest",r)||A.send("UpdateContact",{Contact:s},this.onUpdateContactResponse,this);else if(t instanceof w&&!t.readOnly()){var n=i.map(this.selector.listCheckedOrSelected(),(function(t){return t.UUID()}));this.isSaving(!0),e=t.toObject(n),t.isNew()||(e.Contacts=null),A.send(t.isNew()?"CreateGroup":"UpdateGroup",{Group:e},this.onCreateGroupResponse,this)}}else g.showError(a.i18n("CONTACTSWEBCLIENT/ERROR_EMAIL_OR_NAME_BLANK"))},B.prototype.onCreateContactResponse=function(t,e){this.isSaving(!1),t.Result?(this.requestContactList(),this.viewContact(t.Result.UUID),g.showReport(a.i18n("CONTACTSWEBCLIENT/REPORT_CONTACT_SUCCESSFULLY_ADDED")),u.broadcastEvent("ContactsWebclient::createContactResponse",[t.Result])):c.showErrorByCode(t,a.i18n("CONTACTSWEBCLIENT/ERROR_CREATE_CONTACT"))},B.prototype.onUpdateContactResponse=function(t,e){this.isSaving(!1),t.Result?(this.selectedContact()&&this.selectedContact().edited()&&this.selectedContact().edited(!1),this.requestContactList(),g.showReport(a.i18n("CONTACTSWEBCLIENT/REPORT_CONTACT_SUCCESSFULLY_UPDATED")),u.broadcastEvent("ContactsWebclient::updateContactResponse",[t.Result])):c.showErrorByCode(t,a.i18n("CONTACTSWEBCLIENT/ERROR_UPDATE_CONTACT"))},B.prototype.changeRouting=function(t,e){var s=void 0===(t=t||{}).Storage?this.selectedStorage():t.Storage,i=void 0===t.GroupUUID?this.currentGroupUUID():t.GroupUUID,o=void 0===t.Search?this.search():t.Search,r=void 0===t.Page?this.oPageSwitcher.currentPage():t.Page,n=void 0===t.ContactUUID?"":t.ContactUUID,a=void 0===t.Action?"":t.Action;e?b.replaceHash(v.getContacts(s,i,o,r,n,a)):b.setHash(v.getContacts(s,i,o,r,n,a))},B.prototype.executeNewContact=function(){if(this.showPersonalContacts()){var t="group"===this.selectedStorage()?this.currentGroupUUID():"";this.changeRouting({GroupUUID:t,Action:"create-contact"})}},B.prototype.executeNewGroup=function(){var t="group"===this.selectedStorage()?this.currentGroupUUID():"";this.selector.itemSelected()instanceof P&&this.selector.itemSelected().checked(!0),this.changeRouting({GroupUUID:t,Action:"create-group"})},B.prototype.deleteContact=function(){var t=this.selectedStorage();if("personal"===t||"shared"===t||this.isAddressBookSelected()){var e=i.filter(this.selector.listCheckedOrSelected(),(function(t){return!t.ReadOnly()})),s=e.length,o=a.i18n("CONTACTSWEBCLIENT/CONFIRM_DELETE_CONTACTS_PLURAL",{},null,s),r=i.bind((function(t){t&&this.deleteContacts(e)}),this);y.showPopup(f,[o,r,"",a.i18n("COREWEBCLIENT/ACTION_DELETE")])}else"group"===t&&this.removeFromGroupCommand()},B.prototype.deleteContacts=function(t){var e=this,s=this.selectedContact(),r=i.map(t,(function(t){return t.UUID()}));0<r.length&&(this.preLoadingList(!0),i.each(t,(function(t){t&&(T.clearInfoAboutEmail(t.Email()),!s||t.IsGroup()||t.ReadOnly()||s.readOnly()||s.uuid()!==t.UUID()||(s=null,this.selectedContact(null)))}),this),i.each(this.collection(),(function(e){-1<o.inArray(e,t)&&e.deleted(!0)})),i.delay((function(){e.collection.remove((function(t){return t.deleted()}))}),500),A.send("DeleteContacts",{Storage:this.selectedStorage(),UUIDs:r},(function(t){t.Result||c.showErrorByCode(t,a.i18n("CONTACTSWEBCLIENT/ERROR_DELETE_CONTACTS")),u.broadcastEvent("ContactsWebclient::deleteContactsResponse",[t.Result]),this.requestContactList()}),this),T.markVcardsNonexistentByUid(r))},B.prototype.executeRemoveFromGroup=function(){var t=this,e=this.selectedGroupInList(),s=this.selector.listCheckedOrSelected(),r=i.map(s,(function(t){return t.UUID()}));r=i.compact(r),e&&0<r.length&&(this.preLoadingList(!0),i.each(this.collection(),(function(t){-1<o.inArray(t,s)&&t.deleted(!0)})),i.delay((function(){t.collection.remove((function(t){return t.deleted()}))}),500),A.send("RemoveContactsFromGroup",{GroupUUID:e.UUID(),ContactUUIDs:r},(function(t){t.Result||c.showErrorByCode(t),this.requestContactList()}),this))},B.prototype.executeImport=function(){this.isAddressBookSelected()?this.changeRouting({Storage:this.selectedStorage(),GroupUUID:"",Search:"",Page:1,Action:"import"}):this.changeRouting({Storage:"personal",GroupUUID:"",Search:"",Page:1,Action:"import"})},B.prototype.executeExport=function(t){var e=i.map(this.selector.listChecked(),(function(t){return t.sUUID})),s=this.selectedStorage();"group"===s&&(s="all"),A.send("Export",{Format:t,Storage:s,GroupUUID:this.currentGroupUUID(),ContactUUIDs:e},(function(e){var i=new Blob([e.ResponseText],{type:"text/plain;charset=utf-8"});n.saveAs(i,this.getStorageDisplayName(s)+"."+t,!0)}),this,{Format:"Raw"})},B.prototype.getStorageDisplayName=function(t){let e="contacts";const s=i.find(I.Storages,(e=>e.Id===t));return s?.DisplayName&&(e=s.DisplayName),e},B.prototype.executeCancel=function(){var t=this.selectedItem();t&&(t instanceof N&&!t.readOnly()?t.isNew()?b.setPreviousHash():t.edited()?(t.edited(!1),this.requestContact(t.uuid())):this.changeRouting():t instanceof w&&!t.readOnly()?t.isNew()?b.setPreviousHash():t.edited()?(this.selectedItem(this.selectedOldItem()),t.edited(!1)):this.changeRouting():this.oImportView.visibility()&&b.setPreviousHash())},B.prototype.executeAddContactsToGroup=function(t,e){t&&i.isArray(e)&&0<e.length&&(t.recivedAnim(!0),this.executeAddContactsToGroupUUID(t.UUID(),e))},B.prototype.executeAddContactsToGroupUUID=function(t,e){t&&i.isArray(e)&&0<e.length&&A.send("AddContactsToGroup",{GroupUUID:t,ContactUUIDs:e},this.onAddContactsToGroupResponse,this)},B.prototype.onAddContactsToGroupResponse=function(t){t.Result||c.showErrorByCode(t),this.requestContactList(),this.selector.itemSelected()&&this.requestContact(this.selector.itemSelected().UUID())},B.prototype.executeAddSelectedContactsToGroup=function(t){var e=this.selector.listCheckedOrSelected(),s=[];t&&i.isArray(e)&&0<e.length&&i.each(e,(function(t){t&&!t.IsGroup()&&s.push(t.UUID())}),this),this.executeAddContactsToGroup(t,s)},B.prototype.groupsInContactView=function(t){var e=[],s=[];return t&&!t.groupsIsEmpty()&&(s=t.groups(),e=i.filter(this.groupFullCollection(),(function(t){return 0<=o.inArray(t.UUID(),s)}))),e},B.prototype.onShow=function(){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.show(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0),this.bRefreshContactList=!0},B.prototype.onHide=function(){this.selector.listCheckedOrSelected(!1),this.selector.useKeyboardKeys(!1),this.selectedItem(null),this.oPageSwitcher.hide(),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},B.prototype.onBind=function(){this.selector.initOnApplyBindings(".contact_sub_list .item",".contact_sub_list .selected.item",".contact_sub_list .item .custom_checkbox",o(".contact_list",this.$viewDom),o(".contact_list_scroll.scroll-inner",this.$viewDom));var t=this;this.$viewDom.on("click",".content .item.add_to .dropdown_helper .item",(function(){o(this).hasClass("new-group")?t.executeNewGroup():t.executeAddSelectedContactsToGroup(r.dataFor(this))})),this.showPersonalContacts(v.checkStorageExists("personal")),this.showTeamContacts(v.checkStorageExists("team")),this.showSharedToAllContacts(v.checkStorageExists("shared")),this.selectedStorage(this.selectedStorage()),this.oImportView.onBind(),this.requestGroupFullList(),u.isMobile()||this.hotKeysBind(),this.initUploader()},B.prototype.hotKeysBind=function(){var t=!1;o(document).on("keydown",i.bind((function(e){var s=e.keyCode,i=this.collection()[0],o=this.isSearchFocused(),r=!1;this.shown()&&!l.isTextFieldFocused()&&!o&&e&&s===O.Key.s?(e.preventDefault(),this.searchFocus()):i&&(r=i.selected(),i&&o&&e&&s===O.Key.Down?(this.isSearchFocused(!1),this.selector.itemSelected(i),t=!0):!o&&t&&r&&e&&s===O.Key.Up?(this.isSearchFocused(!0),this.selector.itemSelected(!1),t=!1):r?t=!0:r||(t=!1))}),this))},B.prototype.refreshContactsAndGroups=function(){this.requestContactList(),this.requestGroupFullList()},B.prototype.requestContactList=function(){var t="group"===this.selectedStorage()&&this.selectedGroupInList()?this.selectedGroupInList().UUID():"",e=""!==t?"all":this.selectedStorage();this.loadingList(!0),A.send("GetContacts",{Offset:(this.currentPage()-1)*I.ContactsPerPage,Limit:I.ContactsPerPage,SortField:this.sortBy(),SortOrder:this.sortOrder(),Search:this.search(),GroupUUID:t,Storage:e},this.onGetContactsResponse,this)},B.prototype.requestGroupFullList=function(){A.send("GetGroups",null,this.onGetGroupsResponse,this)},B.prototype.requestContact=function(t){this.loadingViewPane(!0);var e=i.find(this.collection(),(function(e){return e.UUID()===t}));e?(this.selector.itemSelected(e),A.send("GetContact",{UUID:e.UUID()},this.onGetContactResponse,this)):(this.contactUidForRequest(t),this.selector.itemSelected(null),this.selectedItem(null))},B.prototype.editGroup=function(t){var e=new w;e.populate(t),this.selectedOldItem(e),t.edited(!0)},B.prototype.changeGroupType=function(t){this.search(""),this.searchInput(""),this.changeRouting({Storage:t,GroupUUID:""})},B.prototype.onViewGroupClick=function(t){this.search(""),this.searchInput("");var e="string"==typeof t?t:t.UUID();this.changeRouting({Storage:"group",GroupUUID:e})},B.prototype.onRoute=function(t){var e=v.parseContacts(t),s=this.selectedStorage()!==e.Storage||this.currentGroupUUID()!==e.GroupUUID||this.search()!==e.Search,o=this.bRefreshContactList;switch(this.bRefreshContactList=!1,this.pageSwitcherLocked(!0),this.oPageSwitcher.perPage()!==I.ContactsPerPage&&(o=!0),s?(this.oPageSwitcher.clear(),this.oPageSwitcher.perPage(I.ContactsPerPage)):this.oPageSwitcher.setPage(e.Page,I.ContactsPerPage),this.pageSwitcherLocked(!1),e.Page!==this.oPageSwitcher.currentPage()&&b.replaceHash(v.getContacts(e.Storage,e.GroupUUID,e.Search,this.oPageSwitcher.currentPage())),this.currentPage()!==e.Page&&(this.currentPage(e.Page),o=!0),this.selectedStorage()!==e.Storage&&v.checkStorageExists(e.Storage)&&"group"!==e.Storage?(this.selectedStorage(e.Storage),o=!0):"group"!==e.Storage||"create-group"===e.Action||this.currentGroupUUID()===e.GroupUUID&&""!==e.ContactUUID||(this.viewGroup(e.GroupUUID)?o=!1:b.replaceHash(v.getContacts())),this.search()!==e.Search&&(this.search(e.Search),o=!0),this.contactUidForRequest(""),e.ContactUUID?0===this.collection().length?this.contactUidForRequest(e.ContactUUID):this.requestContact(e.ContactUUID):this.selectedItem()instanceof N&&(this.selector.itemSelected(null),this.selectedItem(null)),e.Action){case"create-contact":var r=this.selectedGroupInList(),n=T.getNewContactParams();this.oContactModel.switchToNew(),this.oContactModel.groups(r?[r.UUID()]:[]),n&&(i.each(n,(function(t,e){i.isFunction(this.oContactModel[e])&&this.oContactModel[e](t)}),this),this.oContactModel.extented(!0)),this.selectedItem(this.oContactModel),this.selector.itemSelected(null),this.oImportView.visibility(!1);break;case"create-group":this.oGroupModel.switchToNew(),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.oImportView.visibility(!1);break;case"import":this.selectedItem(null),this.oImportView.visibility(!0),this.selector.itemSelected(null);break;default:e.ContactUUID||e.GroupUUID||(this.selectedItem(null),this.selector.itemSelected(null)),this.oImportView.visibility(!1)}o&&(s&&(this.collection([]),this.contactCount(0)),this.requestContactList()),this.isSaving(!1)},B.prototype.viewGroup=function(t){var e=i.find(this.groupFullCollection(),(function(e){return e&&e.UUID()===t}));return e?(this.groupUidForRequest(""),this.oGroupModel.clear(),this.oGroupModel.uuid(e.UUID()).name(e.Name()),e.IsOrganization()&&this.requestGroup(e),this.selectedGroupInList(e),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.selector.listCheckedOrSelected(!1)):this.groupUidForRequest(t),!!e},B.prototype.deleteGroup=function(t){t&&(this.groupFullCollection.remove((function(e){return e&&e.UUID()===t})),A.send("DeleteGroup",{UUID:t},(function(t){t.Result||c.showErrorByCode(t),this.requestGroupFullList()}),this),this.changeGroupType(I.DefaultStorage))},B.prototype.mailGroup=function(t){this.bAllowComposeMessageToAddresses&&t&&A.send("GetContacts",{Storage:"all",Offset:0,Limit:200,SortField:O.ContactSortField.Name,GroupUUID:t.uuid()},(function(t){var e=t&&t.Result&&t.Result.List,s=(h.isNonEmptyArray(e)?i.compact(i.map(e,(function(t){var e=new P;return e.parse(t),""!==e.Email()?e.getFullEmail():""}))):[]).join(", ");""!==s&&this.composeMessageToAddresses(s)}),this)},B.prototype.dragAndDropHelper=function(t){t&&t.checked(!0);var e=this.selector.itemSelected(),s=l.draggableItems(),r=this.selector.listCheckedOrSelected().length,n=0<r?i.map(this.selector.listCheckedOrSelected(),(function(t){return t.UUID()})):[];return e&&!e.checked()&&e.checked(!0),s.data("drag-contatcs-storage",this.selectedStorage()),s.data("drag-contatcs-uids",n),o(".count-text",s).text(a.i18n("CONTACTSWEBCLIENT/LABEL_DRAG_CONTACTS_PLURAL",{COUNT:r},null,r)),s},B.prototype.contactsDrop=function(t,e,s){if(t){var i=s&&s.helper?s.helper:null,o=i?i.data("drag-contatcs-uids"):null;null!==o&&(l.uiDropHelperAnim(e,s),this.executeAddContactsToGroup(t,o))}},B.prototype.contactsDropToGroupType=function(t,e,s){var i=s&&s.helper,o=i&&i.data("drag-contatcs-storage")||null;null!==(i&&i.data("drag-contatcs-uids")||null)&&null!==o&&t!==o&&(l.uiDropHelperAnim(e,s),this.executeShare())},B.prototype.contactsDropToAddressbook=function(t,e,s){var i=s&&s.helper,o=i&&i.data("drag-contatcs-storage")||null,r=i&&i.data("drag-contatcs-uids")||null;null!==r&&null!==o&&t!==o&&(l.uiDropHelperAnim(e,s),A.send("MoveContactsToStorage",{FromStorage:o,ToStorage:t,UUIDs:r},(function(){this.selector.listCheckedOrSelected(!1),this.requestContactList()}),this))},B.prototype.searchFocus=function(){this.selector.useKeyboardKeys()&&!l.isTextFieldFocused()&&this.isSearchFocused(!0)},B.prototype.viewContact=function(t){if(t){var e="group"===this.selectedStorage()?this.currentGroupUUID():"",s="string"==typeof t?t:t.UUID();this.changeRouting({GroupUUID:e,ContactUUID:s})}},B.prototype.composeMessageToContact=function(t){var e=t?t.getFullEmail():"";""!==e&&this.composeMessageToAddresses(e)},B.prototype.composeMessage=function(){var t=this.selector.listCheckedOrSelected(),e=(h.isNonEmptyArray(t)?i.compact(i.map(t,(function(t){return""!==t.Email()?t.getFullEmail():""}))):[]).join(", ");""!==e&&this.composeMessageToAddresses(e)},B.prototype.onClearSearchClick=function(){this.searchInput(""),this.searchSubmitCommand()},B.prototype.onGetContactResponse=function(t,e){var s=t.Result;if(s){var i=new N,o=this.selector.itemSelected();i.parse(s),o&&o.UUID()===i.uuid()&&(this.selectedContact()instanceof N&&i instanceof N&&this.selectedContact().uuid()===i.uuid()&&i.edited(this.selectedContact().edited()),this.selectedItem(i))}else c.showErrorByCode(t)},B.prototype.onGetContactsResponse=function(t,e){var s=t.Result;if(s){var r=h.pInt(s.ContactCount),n=h.isNonEmptyArray(s.List)?i.compact(i.map(s.List,(function(t){var e=new P;return e.parse(t),e}))):[],a=this.selector.itemSelected(),l=a?i.find(n,(function(t){return a.UUID()===t.UUID()})):null,u=this.selector.listChecked(),p=u&&0<u.length?i.map(u,(function(t){return t.UUID()})):[];h.isNonEmptyArray(p)&&i.each(n,(function(t){t.checked(-1<o.inArray(t.UUID(),p))})),this.collection(n),this.oPageSwitcher.setCount(r),this.contactCount(r),l?(this.selector.itemSelected(l),this.requestContact(l.UUID())):a&&this.changeRouting({},!0),this.selectedGroupEmails(this.selectedGroup()?i.uniq(i.flatten(i.map(this.collection(),(function(t){return t.aEmails})))):[])}else c.showErrorByCode(t);this.loadingList(!1)},B.prototype.viewAllMails=function(){this.selectedGroupEmails().length>0&&this.searchMessagesInInbox("email:"+this.selectedGroupEmails().join(","))},B.prototype.onGetGroupsResponse=function(t,e){var s=t.Result;if(s){var o,r=0,n=[],a=i.find(this.groupFullCollection(),(function(t){return t.selected()}))||null,h=null;for(this.groupFullCollection(n),o=s.length;r<o;r++)if(s[r]){s[r].IsGroup=!0;var l=new P;l.parse(s[r]),l.IsGroup()&&(a&&a.UUID()===l.UUID()&&(h=l),n.push(l))}this.selectedGroupInList(h),null!==a&&null===h&&b.replaceHash(v.getContacts()),this.groupFullCollection(n)}else c.showErrorByCode(t)},B.prototype.onCreateGroupResponse=function(t,e){this.isSaving(!1),t.Result?("string"==typeof t.Result&&""!==t.Result?this.onViewGroupClick(t.Result):this.selectedGroup()&&this.selectedGroup().edited()&&this.selectedGroup().edited(!1),g.showReport(a.i18n("CONTACTSWEBCLIENT/REPORT_GROUP_SUCCESSFULLY_ADDED")),this.requestGroupFullList()):c.showErrorByCode(t,a.i18n("CONTACTSWEBCLIENT/ERROR_SAVE_GROUP"))},B.prototype.executeShare=function(){var t="all"===this.selectedStorage(),e=i.filter(this.selector.listCheckedOrSelected(),(function(t){return"team"!==t.sStorage})),s=i.map(e,(function(t){return t.UUID()}));0<(s=i.compact(s)).length&&(i.each(e,(function(t){t&&T.clearInfoAboutEmail(t.Email())}),this),t||(-1<o.inArray(this.selectedContact(),e)&&this.selectedContact(null),i.each(this.collection(),(function(t){-1<o.inArray(t,e)&&t.deleted(!0)})),i.delay(function(){this.collection.remove((function(t){return t.deleted()}))}.bind(this),500)),"shared"===this.selectedStorage()?this.recivedAnimPersonal(!0):this.recivedAnimShared(!0),A.send("UpdateSharedContacts",{UUIDs:s},(function(){t&&(this.selector.listCheckedOrSelected(!1),this.requestContactList())}),this))},B.prototype.requestGroup=function(t){this.loadingViewPane(!0),t&&A.send("GetGroup",{UUID:t.UUID()},this.onGetGroupResponse,this)},B.prototype.onGetGroupResponse=function(t,e){if(t.Result){var s=t.Result;this.oGroupModel.uuid(h.pString(s.UUID)).name(s.Name).isOrganization(s.IsOrganization).company(s.Company).country(s.Country).state(s.State).city(s.City).street(s.Street).zip(s.Zip).phone(s.Phone).fax(s.Fax).email(s.Email).web(s.Web)}else c.showErrorByCode(t)},B.prototype.initUploader=function(){this.uploaderArea()&&(this.oJua=new d({action:"?/Api/",name:"jua-uploader",queueSize:2,dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:i.extendOwn({Module:I.ServerModuleName,Method:"Import",Parameters:i.bind((function(){return JSON.stringify({GroupUUID:this.currentGroupUUID(),Storage:"personal"})}),this)},u.getCommonRequestParameters())}),this.oJua.on("onSelect",i.bind(this.onImportSelect,this)).on("onComplete",i.bind(this.onImportComplete,this)).on("onBodyDragEnter",i.bind(this.dragActive,this,!0)).on("onBodyDragLeave",i.bind(this.dragActive,this,!1)))},B.prototype.onImportSelect=function(t,e){var s=this.isImportAllowed(),o=!1;return s&&(i.each(I.ImportExportFormats,(function(t){t.toLowerCase()===e.FileName.substr(e.FileName.length-t.length).toLowerCase()&&(o=!0)})),o||(g.showError(this.getFormatDependentText("ERROR_FILE_EXTENSION")),s=!1)),s},B.prototype.onImportComplete=function(t,e,s){var i=0;e&&s&&s.Result?0<(i=h.pInt(s.Result.ImportedCount))?g.showReport(a.i18n("CONTACTSWEBCLIENT/REPORT_CONTACTS_IMPORTED_PLURAL",{NUM:i},null,i)):g.showError(a.i18n("CONTACTSWEBCLIENT/ERROR_IMPORT_NO_CONTACT")):s&&s.ErrorCode===O.Errors.IncorrectFileExtension?g.showError(this.getFormatDependentText("ERROR_FILE_EXTENSION")):g.showError(a.i18n("COREWEBCLIENT/ERROR_UPLOAD_FILE")),this.requestGroupFullList(),this.requestContactList()},B.prototype.addPublicPgpKey=function(){const t=s("Aai9");y.showPopup(t,[{shouldAddToPersonalContact:!0,contactEmail:this.selectedItem().email(),contactUUID:this.selectedItem().uuid(),onSuccessCallback:t=>{if(this.selectedContact()&&this.selectedContact().edited()){this.selectedContact().publicPgpKey(t);const e=this.collection().find((t=>t.UUID()===this.selectedContact().uuid()));e&&e.HasPgpPublicKey(!0)}else this.onUpdateContactResponse({Result:!0})}}])},t.exports=B},"7NIm":(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("9kOp"),n=s("qBBW"),a=s("OfVV"),h=s("Y40+");function l(t){this.oJua=null,this.oParent=t,this.visibility=o.observable(!1),this.importing=o.observable(!1),this.importButtonDom=o.observable(null),this.bVisibleCloseButton=r.isMobile(),this.extensionInfo=t.getFormatDependentText("INFO_IMPORT_CONTACTS")}l.prototype.ViewTemplate="ContactsWebclient_ImportView",l.prototype.onBind=function(){var t=i.map(h.ImportExportFormats,(function(t){return"."+t}));this.oJua=new n({action:"?/Api/",name:"jua-uploader",queueSize:1,clickElement:this.importButtonDom(),hiddenElementsPosition:a.IsRTL?"right":"left",disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:i.extendOwn({Module:h.ServerModuleName,Method:"Import",Parameters:i.bind((function(){return JSON.stringify({GroupUUID:this.oParent.currentGroupUUID(),Storage:this.oParent.isAddressBookSelected()?this.oParent.selectedStorage():"personal"})}),this)},r.getCommonRequestParameters()),accept:t.join(",")}),this.oJua.on("onSelect",i.bind(this.oParent.onImportSelect,this.oParent)).on("onStart",i.bind(this.onFileUploadStart,this)).on("onComplete",i.bind(this.onFileUploadComplete,this))},l.prototype.onFileUploadStart=function(){this.importing(!0)},l.prototype.onFileUploadComplete=function(t,e,s){this.importing(!1),this.oParent.onImportComplete(t,e,s)},t.exports=l},Ub4N:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("KC/L"),n=s("TdEd").run("SettingsWebclient","getAbstractSettingsFormViewClass"),a=s("Y40+");function h(){n.call(this,a.ServerModuleName),this.contactsPerPageValues=o.observableArray(r.getAdaptedPerPageList(a.ContactsPerPage)),this.contactsPerPage=o.observable(a.ContactsPerPage)}i.extendOwn(h.prototype,n.prototype),h.prototype.ViewTemplate="ContactsWebclient_ContactsSettingsFormView",h.prototype.getCurrentValues=function(){return[this.contactsPerPage()]},h.prototype.revertTeamValues=function(){this.contactsPerPage(a.ContactsPerPage)},h.prototype.getParametersForSave=function(){return{ContactsPerPage:this.contactsPerPage()}},h.prototype.applySavedValues=function(t){a.update(t.ContactsPerPage)},t.exports=new h},zXiY:(t,e,s)=>{"use strict";var i=s("H20a"),o=s("C5H3");t.exports=new o(i.i18n("CONTACTSWEBCLIENT/ACTION_SHOW_CONTACTS"))},gBUy:(t,e,s)=>{"use strict";var i=s("p09A");function o(){this.AddressBooks=i.observableArray([])}s("Y40+"),o.prototype.ViewTemplate="ContactsWebclient_MobileSyncSettingsView",o.prototype.populate=function(t){if(Array.isArray(t.Contacts)){const e=t.Contacts.map((t=>({DisplayName:t.Name,DavUrl:t.Url})));this.AddressBooks(e)}},t.exports=new o},MYHY:(t,e,s)=>{"use strict";var i=s("a7T2"),o=s("p09A"),r=s("KC/L"),n=s("hW2p"),a=s("CUTT");function h(){this.vcard=o.observable(null)}h.prototype.ViewTemplate="ContactsWebclient_VcardAttachmentView",h.prototype.doAfterPopulatingMessage=function(t){var e=t&&r.isNonEmptyArray(t.aExtend)?t.aExtend:[],s=i.find(e,(function(t){return"Object/Aurora\\Modules\\Mail\\Classes\\Vcard"===t["@Object"]}));if(s){var o=n.getVcard(s.File);o||(o=new a).parse(s),this.vcard(o)}else this.vcard(null)},t.exports=new h},"Cox/":function(t,e,s){var i,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,s=function(){return t.URL||t.webkitURL||t},i=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=/constructor/i.test(t.HTMLElement)||t.safari,n=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},h=function(t){setTimeout((function(){"string"==typeof t?s().revokeObjectURL(t):t.remove()}),4e4)},l=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},c=function(e,c,u){u||(e=l(e));var p,d=this,m="application/octet-stream"===e.type,C=function(){!function(t,e){for(var s=(e=[].concat(e)).length;s--;){var i=t["on"+e[s]];if("function"==typeof i)try{i.call(t,t)}catch(t){a(t)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,o)return p=s().createObjectURL(e),void setTimeout((function(){var t,e;i.href=p,i.download=c,t=i,e=new MouseEvent("click"),t.dispatchEvent(e),C(),h(p),d.readyState=d.DONE}));!function(){if((n||m&&r)&&t.FileReader){var i=new FileReader;return i.onloadend=function(){var e=n?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,d.readyState=d.DONE,C()},i.readAsDataURL(e),void(d.readyState=d.INIT)}p||(p=s().createObjectURL(e)),m?t.location.href=p:t.open(p,"_blank")||(t.location.href=p),d.readyState=d.DONE,C(),h(p)}()},u=c.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,s){return e=e||t.name||"download",s||(t=l(t)),navigator.msSaveOrOpenBlob(t,e)}:(u.abort=function(){},u.readyState=u.INIT=0,u.WRITING=1,u.DONE=2,u.error=u.onwritestart=u.onprogress=u.onwrite=u.onabort=u.onerror=u.onwriteend=null,function(t,e,s){return new c(t,e||t.name||"download",s)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==s.amdD&&null!==s.amdO&&(void 0===(i=function(){return o}.call(e,s,e,t))||(t.exports=i))}}]);