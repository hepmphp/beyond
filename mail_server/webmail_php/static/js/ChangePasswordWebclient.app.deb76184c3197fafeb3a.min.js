"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[711],{"DR/j":(s,t,e)=>{var o=e("a7T2"),n=e("KC/L");s.exports={ShowSingleMailChangePasswordInCommonSettings:!1,ShowSingleMailChangePasswordInSecuritySettings:!1,init:function(s){var t=s.ChangePasswordWebclient;o.isEmpty(t)||(this.ShowSingleMailChangePasswordInCommonSettings=n.pBool(t.ShowSingleMailChangePasswordInCommonSettings,this.ShowSingleMailChangePasswordInCommonSettings),this.ShowSingleMailChangePasswordInSecuritySettings=n.pBool(t.ShowSingleMailChangePasswordInSecuritySettings,this.ShowSingleMailChangePasswordInSecuritySettings))}}},pRlU:(s,t,e)=>{s.exports=function(s){if(e("9kOp").isUserNormalOrTenant()){var t=e("DR/j");return t.init(s),{start:function(s){t.ShowSingleMailChangePasswordInSecuritySettings&&s.isModuleEnabled("SecuritySettingsWebclient")?s.run("SecuritySettingsWebclient","registerSecuritySettingsSection",[function(){return e("kHh6")},"ChangePasswordWebclient"]):t.ShowSingleMailChangePasswordInCommonSettings&&s.run("SettingsWebclient","registerSettingsTabSection",[function(){return e("kHh6")},"common"])},getChangePasswordPopup:function(){return e("BgFg")},isChangePasswordButtonAllowed:function(s,e){return!t.ShowSingleMailChangePasswordInCommonSettings&&!t.ShowSingleMailChangePasswordInSecuritySettings&&!!e.aExtend.AllowChangePasswordOnMailServer}}}return null}},BgFg:(s,t,e)=>{var o=e("a7T2"),n=e("M4cL"),a=e("p09A"),r=e("H20a"),i=(e("Tt1R"),e("171C")),h=e("EFhx"),l=e("/QeJ"),u=e("9kOp"),c=e("skxT"),d=e("oUN1"),w=e("hT1I"),P=e("o1lX");function S(){P.call(this),this.currentPassword=a.observable(""),this.newPassword=a.observable(""),this.confirmPassword=a.observable(""),this.accountId=a.observable(""),this.hasOldPassword=a.observable(!1),this.oParams=null}e("DR/j"),o.extendOwn(S.prototype,P.prototype),S.prototype.PopupTemplate="ChangePasswordWebclient_ChangePasswordPopup",S.prototype.onOpen=function(s){this.currentPassword(""),this.newPassword(""),this.confirmPassword(""),this.accountId(s.iAccountId),this.hasOldPassword(s.bHasOldPassword),this.oParams=s},S.prototype.change=function(){var s=n.trim(this.newPassword()),t=n.trim(this.confirmPassword());i.checkPassword(s,t)&&this.sendChangeRequest()},S.prototype.sendChangeRequest=function(){var s={AccountId:this.accountId(),CurrentPassword:n.trim(this.currentPassword()),NewPassword:n.trim(this.newPassword())},t={Module:this.oParams.sModule,Method:"ChangePassword"};h.send(this.oParams.sModule,"ChangePassword",s,this.onUpdatePasswordResponse,this),h.abortAndStopSendRequests(t)},S.prototype.onUpdatePasswordResponse=function(s,t){!1===s.Result?(l.showErrorByCode(s,r.i18n("CHANGEPASSWORDWEBCLIENT/ERROR_PASSWORD_NOT_SAVED")),h.startSendRequests()):s.Result&&s.Result.RefreshToken?(u.setAuthToken(s.Result.RefreshToken),d.showPopup(w,[r.i18n("CHANGEPASSWORDWEBCLIENT/REPORT_PASSWORD_CHANGED")+" "+r.i18n("CHANGEPASSWORDWEBCLIENT/REPORT_REDIRECT_TO_LOGIN"),function(){u.logout()}])):(this.hasOldPassword()?c.showReport(r.i18n("CHANGEPASSWORDWEBCLIENT/REPORT_PASSWORD_CHANGED")):c.showReport(r.i18n("CHANGEPASSWORDWEBCLIENT/REPORT_PASSWORD_SET")),this.closePopup(),o.isFunction(this.oParams.fAfterPasswordChanged)&&this.oParams.fAfterPasswordChanged())},s.exports=new S},kHh6:(s,t,e)=>{var o=e("a7T2"),n=e("p09A"),a=e("H20a"),r=e("TdEd"),i=e("oUN1"),h=r.run("ChangePasswordWebclient","getChangePasswordPopup");function l(){this.oDefaultAccount=null,this.showChangePasswordButton=n.observable(!1),this.changePasswordHintText=n.observable(""),this.init()}e("DR/j"),l.prototype.ViewTemplate="ChangePasswordWebclient_ChangeDefaultMailAccountPasswordView",l.prototype.init=function(){var s=r.run("MailWebclient","getAccountList",[]),t=function(){var t=s.getDefault();t&&t.aExtend.AllowChangePasswordOnMailServer?(this.oDefaultAccount=t,this.showChangePasswordButton(!0),this.changePasswordHintText(a.i18n("CHANGEPASSWORDWEBCLIENT/HINT_CHANGE_PASSWORD",{EMAIL:t.email()}))):(this.oDefaultAccount=null,this.showChangePasswordButton(!1))}.bind(this);s&&o.isFunction(s.collection)&&(t(),s.collection.subscribe(t))},l.prototype.changePassword=function(){this.oDefaultAccount&&i.showPopup(h,[{iAccountId:this.oDefaultAccount.id(),sModule:"Mail",bHasOldPassword:!0}])},s.exports=new l},"171C":(s,t,e)=>{var o=e("a7T2"),n=e("skxT"),a={checkIfFieldsEmpty:function(s,t){var e=o.find(s,(function(s){return""===s()}));return!e||(t&&n.showError(t),e.focused(!0),!1)},checkPassword:function(s,t){var o=e("H20a"),a=e("OfVV"),r=!1;return t!==s?n.showError(o.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):a.PasswordMinLength>0&&s.length<a.PasswordMinLength?n.showError(o.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SHORT").replace("%N%",a.PasswordMinLength)):!a.PasswordMustBeComplex||s.match(/([0-9])/)&&s.match(/([!,%,&,@,#,$,^,*,?,_,~])/)?r=!0:n.showError(o.i18n("COREWEBCLIENT/ERROR_PASSWORD_TOO_SIMPLE")),r}};s.exports=a}}]);