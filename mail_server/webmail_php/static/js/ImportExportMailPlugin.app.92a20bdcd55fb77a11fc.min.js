"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[970],{ssyR:(t,e,o)=>{var i=o("a7T2"),s=o("KC/L");t.exports={ModuleName:"ImportExportMailPlugin",UploadSizeLimitMb:0,init:function(t){var e=t[this.ModuleName]||{};i.isEmpty(e)||(this.UploadSizeLimitMb=s.pInt(e.UploadSizeLimitMb,this.UploadSizeLimitMb))}}},J6jY:(t,e,o)=>{var i=o("TdEd"),s=o("ssyR");t.exports=function(t){return s.init(t),i.isModuleAvailable("Mail")&&i.isModuleAvailable("MailWebclient")?{getImportExportPopup:function(){return o("9k3F")}}:null}},"9k3F":(t,e,o)=>{var i=o("a7T2"),s=o("p09A"),n=o("REt5"),r=o("H20a"),a=o("EFhx"),p=o("qBBW"),l=o("skxT"),u=o("9kOp"),d=o("/QeJ"),h=o("o1lX"),P=o("F0Fd"),I=o("ssyR");function T(){h.call(this),this.zipFile=s.observable(null),this.status=s.observable(""),this.iAutoReloadTimer=-1,this.opened=s.observable(!1),this.options=s.observableArray([]),this.selectedFolder=s.observable(""),this.uploaderButton=s.observable(null),this.oJua=null,this.defaultOptionsAfterRender=n.defaultOptionsAfterRender,this.exportButtonText=s.observable(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),this.importButtonText=s.observable(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_IMPORT")),this.processing=s.computed((function(){return"ready"!==this.status()&&"error"!==this.status()&&""!==this.status()}),this),this.status.subscribe((function(t){"ready"===t?(this.opened()||this.openPopup({}),this.exportButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_DOWNLOAD_ZIP")),clearTimeout(this.iAutoReloadTimer)):"error"===t&&(l.showError(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ERROR_GENERATE_ZIP")),this.exportButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),clearTimeout(this.iAutoReloadTimer))}),this)}i.extendOwn(T.prototype,h.prototype),T.prototype.PopupTemplate="ImportExportMailPlugin_ImportExportPopup",T.prototype.onOpen=function(){var t=P.oFolderListItems[P.editedAccountId()];this.options(t?t.getOptions("",!0,!1,!1):[])},T.prototype.onShow=function(){this.opened(!0),this.initUploader()},T.prototype.onCancelClick=function(){this.opened(!1),this.closeCommand()},T.prototype.exportMail=function(){""===this.status()?(this.status("prepare"),a.send(I.ModuleName,"ExportMailPrepare",{},this.onExportMailResponse,this),this.setAutoReloadTimer()):"ready"===this.status()&&this.Download()},T.prototype.setAutoReloadTimer=function(){var t=this;clearTimeout(this.iAutoReloadTimer),this.iAutoReloadTimer=setTimeout((function(){t.Status()}),1e4)},T.prototype.Status=function(){this.setAutoReloadTimer(),""!==this.status()&&a.send(I.ModuleName,"ExportMailStatus",{Zip:this.zipFile()},this.onStatusResponse,this)},T.prototype.onExportMailResponse=function(t){var e=t.Result;e&&"prepare"===this.status()&&e.Zip&&(this.zipFile(e.Zip),this.exportButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_GENERATING_ZIP")),a.send(I.ModuleName,"ExportMailGenerate",{AccountId:P.editedAccountId(),Folder:this.selectedFolder(),Zip:this.zipFile()}))},T.prototype.onStatusResponse=function(t){var e=t.Result;e&&e.Status&&this.status(e.Status)},T.prototype.Download=function(){"ready"===this.status()&&(this.status(""),this.exportButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_EXPORT")),window.location.href="?transfer-mail/export/"+this.zipFile())},T.prototype.initUploader=function(){var t=this;this.uploaderButton()&&(this.oJua=new p({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!0,hidden:i.extendOwn({Module:I.ModuleName,Method:"ImportMail",Parameters:function(){return JSON.stringify({AccountId:P.editedAccountId(),Folder:t.selectedFolder()})}},u.getCommonRequestParameters())}),this.oJua.bEnableButton=!0,this.oJua.on("onSelect",i.bind(this.onFileUploadSelect,this)).on("onStart",i.bind(this.onFileUploadStart,this)).on("onComplete",i.bind(this.onFileUploadComplete,this)))},T.prototype.onFileUploadSelect=function(t,e){if(I.UploadSizeLimitMb>0&&e.Size/1048576>I.UploadSizeLimitMb)return l.showError(r.i18n("IMPORTEXPORTMAILPLUGIN/ERROR_SIZE_LIMIT",{SIZE:I.UploadSizeLimitMb})),!1},T.prototype.onFileUploadStart=function(){this.status("upload"),this.importButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_IMPORTING_ZIP"))},T.prototype.onFileUploadComplete=function(t,e,o){var i=!(e&&o&&o.Result);this.status(""),this.importButtonText(r.i18n("IMPORTEXPORTMAILPLUGIN/POPUP_ACTION_IMPORT")),i?d.showErrorByCode(o,r.i18n("IMPORTEXPORTMAILPLUGIN/UNKNOWN_ERROR")):l.showReport(r.i18n("IMPORTEXPORTMAILPLUGIN/INFO_UPLOAD_COMPLETED"))},t.exports=new T}}]);