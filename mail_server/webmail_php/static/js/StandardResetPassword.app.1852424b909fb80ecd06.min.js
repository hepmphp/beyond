"use strict";(self.webpackChunkafterlogic_aurora_platform=self.webpackChunkafterlogic_aurora_platform||[]).push([[170],{Q5UF:(e,t,s)=>{var o=s("a7T2"),i=s("KC/L");e.exports={HashModuleName:"reset-password",BottomInfoHtmlText:"",CustomLogoUrl:"",RecoveryEmail:"",RecoveryEmailConfirmed:!1,RecoveryAccount:"",init:function(e){var t=e.StandardResetPassword;o.isEmpty(t)||(this.HashModuleName=i.pString(t.HashModuleName,this.HashModuleName),this.BottomInfoHtmlText=i.pString(t.BottomInfoHtmlText,this.BottomInfoHtmlText),this.CustomLogoUrl=i.pString(t.CustomLogoUrl,this.CustomLogoUrl),this.RecoveryEmail=i.pString(t.RecoveryEmail,this.RecoveryEmail),this.RecoveryEmailConfirmed=i.pBool(t.RecoveryEmailConfirmed,this.RecoveryEmailConfirmed),this.RecoveryAccount=i.pString(t.RecoveryAccount,this.RecoveryAccount))},update:function(e,t){this.RecoveryEmail=i.pString(e,this.RecoveryEmail),this.RecoveryEmailConfirmed=""===this.RecoveryEmail,this.RecoveryAccount=i.pString(t,this.RecoveryAccount)}}},Y4Lk:(e,t,s)=>{e.exports=function(e){var t=s("a7T2"),o=s("H20a"),i=s("9kOp"),r=s("Q5UF"),a=i.getUserRole()===Enums.UserRole.Anonymous;if(r.init(e),!i.isPublic()&&a){var n=function(){i.subscribeEvent("AnonymousUserForm::PopulateBeforeButtonsControllers",t.bind((function(e){!t.isFunction(e.RegisterBeforeButtonsController)||"StandardLoginFormWebclient"!==e.ModuleName&&"MailLoginFormWebclient"!==e.ModuleName||e.RegisterBeforeButtonsController(s("8fb7"))}),this))};return i.isMobile()?{start:function(e){n()},getScreens:function(){var e={},t=s("goeb");return t&&(t.ViewTemplate="StandardResetPassword_ResetPasswordMobileFormView",e[r.HashModuleName]=function(){return t}),e}}:{start:function(e){n()},getScreens:function(){var e={};return e[r.HashModuleName]=function(){return s("goeb")},e}}}return i.isUserNormalOrTenant()&&!i.isMobile()?{start:function(e){e.isModuleEnabled("SecuritySettingsWebclient")?e.run("SecuritySettingsWebclient","registerSecuritySettingsSection",[function(){var e=s("mQBM");return e.ViewTemplate="StandardResetPassword_ResetPasswordSettingsSectionFormView",e},"StandardResetPassword"]):e.run("SettingsWebclient","registerSettingsTab",[function(){return s("mQBM")},r.HashModuleName,o.i18n("STANDARDRESETPASSWORD/LABEL_SETTINGS_TAB")])}}:null}},GVZc:(e,t,s)=>{var o=s("M4cL"),i=s("a7T2"),r=s("p09A"),a=s("kG5I"),n=s("H20a"),c=s("KC/L"),l=s("/QeJ"),h=s("EFhx"),R=s("o1lX"),d=s("skxT"),E=s("Q5UF");function m(){R.call(this),this.recoveryEmail=r.observable(""),this.recoveryEmailFocus=r.observable(!1),this.password=r.observable(""),this.passwordFocus=r.observable(!1),this.updateMode=r.observable(!1),this.loading=r.observable(!1),this.recoveryEmailInfo=r.observable("")}i.extendOwn(m.prototype,R.prototype),m.prototype.PopupTemplate="StandardResetPassword_SetRecoveryEmailPopup",m.prototype.onOpen=function(e){this.loading(!1),this.fillRecoveryEmailInfo(),this.updateMode(c.isNonEmptyString(E.RecoveryEmail)),this.fCallback=e,this.recoveryEmailFocus(!0)},m.prototype.onClose=function(){this.recoveryEmail(""),this.password("")},m.prototype.fillRecoveryEmailInfo=function(){""!==E.RecoveryEmail?this.recoveryEmailInfo(n.i18n("STANDARDRESETPASSWORD/INFO_YOUR_CURRENT_RECOVERY_EMAIL",{EMAIL:E.RecoveryEmail})):this.recoveryEmailInfo("")},m.prototype.save=function(){var e=o.trim(this.recoveryEmail());return""===e||a.isCorrectEmail(e)?""===o.trim(this.password())?(d.showError(n.i18n("STANDARDRESETPASSWORD/ERROR_EMPTY_PASSWORD")),void this.passwordFocus(!0)):(this.loading(!0),void h.send("StandardResetPassword","UpdateSettings",{RecoveryEmail:this.recoveryEmail(),Password:this.password()},this.onUpdateSettingsResponse,this)):(d.showError(n.i18n("STANDARDRESETPASSWORD/ERROR_INCORRECT_EMAIL")),void this.recoveryEmailFocus(!0))},m.prototype.onUpdateSettingsResponse=function(e,t){this.loading(!1),e.Result?(i.isFunction(this.fCallback)&&this.fCallback(e.Result),this.closePopup()):l.showErrorByCode(e,n.i18n("STANDARDRESETPASSWORD/ERROR_SET_RECOVERY_EMAIL"))},e.exports=new m},"8fb7":(e,t,s)=>{var o=s("Q5UF");function i(){this.sResetPasswordHash="#"+o.HashModuleName}i.prototype.ViewTemplate="StandardResetPassword_ForgotPasswordController",e.exports=new i},goeb:(e,t,s)=>{var o=s("a7T2"),i=s("M4cL"),r=s("p09A"),a=s("kG5I"),n=s("H20a"),c=s("KC/L"),l=s("REt5"),h=s("/QeJ"),R=s("9kOp"),d=s("W66n"),E=s("skxT"),m=s("OfVV"),u=s("doeu"),S=s("EFhx"),p=s("Q5UF"),v=i("html");function y(){u.call(this,"StandardResetPassword"),this.sResetPasswordHash="#"+p.HashModuleName,this.sCustomLogoUrl=p.CustomLogoUrl,this.sBottomInfoHtmlText=p.BottomInfoHtmlText,this.email=r.observable(""),this.emailFocus=r.observable(!1),this.newPassword=r.observable(""),this.newPasswordFocus=r.observable(!1),this.confirmPassword=r.observable(""),this.confirmPasswordFocus=r.observable(!1),this.step=r.observable(1),this.gettingUserPublicId=r.observable(!1),this.resetPasswordHashUserPublicId=r.observable(""),this.resetPasswordHashInfo=r.computed((function(){return this.resetPasswordHashUserPublicId()?n.i18n("STANDARDRESETPASSWORD/INFO_RESET_PASSWORD_HASH",{USERNAME:this.resetPasswordHashUserPublicId(),SITE_NAME:m.SiteName}):this.gettingUserPublicId()?"":n.i18n("STANDARDRESETPASSWORD/ERROR_LINK_NOT_VALID")}),this),this.recoverThroughEmailText=r.observable(""),this.sendRecoveryEmailText=r.observable(""),this.gettingRecoveryEmail=r.observable(!1),this.continueCommand=l.createCommand(this,this.continue,(function(){return!this.gettingRecoveryEmail()})),this.sendingRecoveryEmail=r.observable(!1),this.sendRecoveryEmailCommand=l.createCommand(this,this.sendRecoveryEmail,(function(){return!this.sendingRecoveryEmail()})),this.changingPassword=r.observable(!1),this.changePasswordCommand=l.createCommand(this,this.changePassword,(function(){return!this.changingPassword()})),this.passwordChanged=r.observable(!1),this.shake=r.observable(!1).extend({autoResetToFalse:800}),R.broadcastEvent("StandardResetPassword::ConstructView::after",{Name:this.ViewConstructorName,View:this})}o.extendOwn(y.prototype,u.prototype),y.prototype.ViewTemplate="StandardResetPassword_ResetPasswordFormView",y.prototype.ViewConstructorName="CResetPasswordFormView",y.prototype.onBind=function(){v.addClass("non-adjustable-valign")},y.prototype.getResetPasswordHash=function(){var e=d.getCurrentHashArray();return e.length>=2&&e[0]===p.HashModuleName?e[1]:""},y.prototype.onRoute=function(){var e=this.getResetPasswordHash();this.resetPasswordHashUserPublicId(""),c.isNonEmptyString(e)?(this.step(0),this.gettingUserPublicId(!0),S.send("StandardResetPassword","GetUserPublicId",{Hash:e},(function(e){this.gettingUserPublicId(!1),c.isNonEmptyString(e.Result)&&this.resetPasswordHashUserPublicId(e.Result)}),this)):(this.step(1),o.delay(o.bind((function(){""===this.email()&&this.emailFocus(!0)}),this),1))},y.prototype.continue=function(){var e=i.trim(this.email());""===e?(this.emailFocus(!0),this.shake(!0)):a.isCorrectEmail(e)?(this.gettingRecoveryEmail(!0),S.send("StandardResetPassword","GetStarredRecoveryEmailAddress",{UserPublicId:this.email()},(function(e,t){this.gettingRecoveryEmail(!1),c.isNonEmptyString(e&&e.Result)?(this.step(2),this.recoverThroughEmailText(n.i18n("STANDARDRESETPASSWORD/INFO_EMAIL_RECOVER_SENT",{USERNAME:this.email(),EMAIL:e&&e.Result,SITE_NAME:m.SiteName})),this.sendRecoveryEmailText(n.i18n("STANDARDRESETPASSWORD/INFO_RECOVERY_LINK_SENT",{USERNAME:this.email(),EMAIL:e&&e.Result,SITE_NAME:m.SiteName}))):h.showErrorByCode(e,n.i18n("STANDARDRESETPASSWORD/ERROR_RECOVERY_EMAIL_NOT_FOUND"))}),this)):E.showError(n.i18n("STANDARDRESETPASSWORD/ERROR_INCORRECT_EMAIL"))},y.prototype.backToStep1=function(){this.recoverThroughEmailText(""),this.sendRecoveryEmailText(""),this.step(1),this.emailFocus(!0)},y.prototype.backToStepLogin=function(){d.setHash("")},y.prototype.sendRecoveryEmail=function(){this.sendingRecoveryEmail(!0),S.send("StandardResetPassword","SendPasswordResetEmail",{UserPublicId:this.email()},(function(e,t){this.sendingRecoveryEmail(!1),e&&e.Result?this.step(3):h.showErrorByCode(e,n.i18n("STANDARDRESETPASSWORD/ERROR_RECOVERY_EMAIL_NOT_SENT"))}),this)},y.prototype.changePassword=function(){""===i.trim(this.newPassword())?(this.newPasswordFocus(!0),this.shake(!0)):""===i.trim(this.confirmPassword())?(this.confirmPasswordFocus(!0),this.shake(!0)):this.newPassword()!==this.confirmPassword()?E.showError(n.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):(this.changingPassword(!0),this.passwordChanged(!1),S.send("StandardResetPassword","ChangePassword",{Hash:this.getResetPasswordHash(),NewPassword:this.newPassword()},(function(e,t){this.changingPassword(!1),e&&!0===e.Result?this.passwordChanged(!0):h.showErrorByCode(e,n.i18n("STANDARDRESETPASSWORD/ERROR_PASSWORD_CHANGE"))}),this))},e.exports=new y},mQBM:(e,t,s)=>{var o=s("a7T2"),i=s("p09A"),r=s("H20a"),a=(s("KC/L"),s("TdEd")),n=s("oUN1"),c=a.run("SettingsWebclient","getAbstractSettingsFormViewClass"),l=s("GVZc"),h=s("Q5UF");function R(){c.call(this,"StandardResetPassword"),this.recoveryEmail=i.observable(h.RecoveryEmail),this.recoveryEmailConfirmed=i.observable(h.RecoveryEmailConfirmed),this.recoveryAccount=i.observable(h.RecoveryAccount),this.recoveryEmailInfo=i.computed((function(){let e="";if(""!==this.recoveryEmail()){const t=this.recoveryEmailConfirmed()?"INFO_YOU_HAVE_RECOVERY_EMAIL":"INFO_YOU_HAVE_NOT_CONFIRMED_RECOVERY_EMAIL";e=r.i18n("STANDARDRESETPASSWORD/"+t,{EMAIL:this.recoveryEmail()}),this.recoveryAccount()&&(e+="<br><br>"+r.i18n("STANDARDRESETPASSWORD/INFO_CURRENT_RECOVERY_ACCOUNT",{ACCOUNT:this.recoveryAccount()}))}else e=r.i18n("STANDARDRESETPASSWORD/INFO_NOT_SET_RECOVERY_EMAIL");return e}),this)}o.extendOwn(R.prototype,c.prototype),R.prototype.ViewTemplate="StandardResetPassword_ResetPasswordSettingsFormView",R.prototype.setRecoveryEmail=function(){n.showPopup(l,[function(e){const t=e?.RecoveryEmail,s=e?.RecoveryAccount;this.updateSettings(t,s)}.bind(this)])},R.prototype.updateSettings=function(e,t){h.update(e,t),this.recoveryEmail(h.RecoveryEmail),this.recoveryEmailConfirmed(h.RecoveryEmailConfirmed),this.recoveryAccount(h.RecoveryAccount)},e.exports=new R}}]);